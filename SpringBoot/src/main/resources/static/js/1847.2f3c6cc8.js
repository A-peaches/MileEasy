"use strict";(self["webpackChunkmile"]=self["webpackChunkmile"]||[]).push([[1847],{71847:function(e,t,l){l.r(t),l.d(t,{default:function(){return re}});var i=l(20641),s=l(90033),n=l(53751);const a={class:"cards page-back mx-auto"},o={class:"bold-x-lg my-5",style:{"font-family":"KB_C3"}},r={class:"d-flex justify-content-end align-items-center",style:{"margin-top":"10vh","padding-left":"3%","padding-right":"3%"}},c={class:"d-flex justify-content-end align-items-center mt-3"},d={class:"md",style:{width:"95%","text-align":"right","margin-right":"3%","font-size":"14pt"}},h=(0,i.Lk)("span",{style:{"text-decoration":"underline"}},"엑셀 양식 다운로드",-1),g=(0,i.Lk)("i",{class:"bi bi-download lg2"},null,-1),m={key:0,class:"pr-5 pl-5 pb-5 pt-4",style:{"margin-top":"10vh"}},u=["onClick"],f={class:"d-flex align-items-center justify-content-between"},p={class:"d-flex justify-content-start align-items-center",style:{width:"80%"}},y={key:0,style:{"padding-left":"3%"}},k=(0,i.Lk)("span",{class:"md",style:{color:"#edbb00"}},"NEW",-1),w=[k],x={class:"lg2 pl-2 pr-2",style:{"margin-left":"3%","text-align":"left","font-family":"KB_C2"}},L={class:"md"},b=["onClick"],v=(0,i.Lk)("span",{class:"md",style:{"text-align":"right"}},"파일 다운로드 〉",-1),_=[v],C={key:1,class:"pr-5 pl-5 pb-5 pt-4",style:{"margin-top":"10vh"}},D={key:0},S=["onClick"],E={class:"d-flex align-items-center justify-content-between"},I={class:"d-flex justify-content-start align-items-center",style:{width:"80%"}},A={key:0,style:{"padding-left":"3%"}},M=(0,i.Lk)("span",{class:"md",style:{color:"#edbb00"}},"NEW",-1),P=[M],B={class:"lg2 pl-2 pr-2",style:{"margin-left":"3%","text-align":"left","font-family":"KB_C2"}},F={class:"md"},X=["onClick"],Y=(0,i.Lk)("span",{class:"md",style:{"text-align":"right"}},"파일 다운로드 〉",-1),K=[Y],$={key:1},j=(0,i.Lk)("p",{class:"lg2",style:{"text-align":"center",color:"#aeaeb2","font-family":"KB_C2"}},"해당 날짜에 존재하는 마일리지 엑셀 파일이 없습니다.",-1),H=[j],z={key:2,style:{"margin-bottom":"3%"}},N=(0,i.Lk)("i",{class:"bi bi-arrow-clockwise lg2"},null,-1),O={class:"button-container mt-auto"},Q={class:"d-flex justify-content-evenly mx-auto"},V={class:"my-5"},W={class:"my-5"},T={key:0,class:"modals"},U={class:"modals-content",ref:"modal",style:{width:"40%",height:"45%","background-color":"#f9f9f9"}},q=(0,i.Lk)("p",{class:"text-left fw-bold mb-3",style:{"font-size":"19pt"}}," 마일리지 점수 업로드 ",-1),G={class:"p-4",style:{"margin-top":"5vh"}},J={class:"d-flex input-gray mt-3 p-4"},R={class:"d-flex justify-content-center",style:{"margin-top":"8vh"}};function Z(e,t,l,k,v,M){const Y=(0,i.g2)("Datepicker");return(0,i.uX)(),(0,i.CE)(i.FK,null,[(0,i.Lk)("div",a,[(0,i.Lk)("h2",o,(0,s.v_)(M.mileInfo?M.mileInfo.mile_no:"")+" 마일리지 점수",1),(0,i.Lk)("div",r,[(0,i.bF)(Y,{modelValue:v.selectedDate,"onUpdate:modelValue":t[0]||(t[0]=e=>v.selectedDate=e),format:M.formatDate,style:{width:"25%"}},null,8,["modelValue","format"])]),(0,i.Lk)("div",c,[(0,i.Lk)("span",d,[(0,i.Lk)("button",{onClick:t[1]||(t[1]=(...e)=>M.downloadSample&&M.downloadSample(...e))},[h,(0,i.eW)("  "),g])])]),!v.selectedDate&&M.paginatedScores.length>0?((0,i.uX)(),(0,i.CE)("div",m,[((0,i.uX)(!0),(0,i.CE)(i.FK,null,(0,i.pI)(M.paginatedScores,(e=>((0,i.uX)(),(0,i.CE)("div",{key:e.mile_excel_no,class:(0,s.C4)(["mx-auto mb-4 border-bottom p-4 input-base input-white list-wrapper",{activeDelete:v.deleteArray.includes(e)}]),onClick:t=>M.addDeleteArray(e),style:{width:"90%",height:"5em","box-shadow":"0 4px 8px rgba(0, 0, 0, 0.2)","background-color":"#FBFBFB"}},[(0,i.Lk)("div",f,[(0,i.Lk)("div",p,[M.isNew(e.mile_excel_date)?((0,i.uX)(),(0,i.CE)("div",y,w)):(0,i.Q3)("",!0),(0,i.Lk)("span",x,(0,s.v_)(e.mile_excel_file),1),(0,i.Lk)("span",L,(0,s.v_)(M.formatting(e.mile_excel_date)),1)]),(0,i.Lk)("button",{onClick:(0,n.D$)((t=>M.downloadExcel(e.mile_excel_file)),["stop"])},_,8,b)])],10,u)))),128))])):((0,i.uX)(),(0,i.CE)("div",C,[M.paginatedScores.length>0?((0,i.uX)(),(0,i.CE)("div",D,[((0,i.uX)(!0),(0,i.CE)(i.FK,null,(0,i.pI)(M.paginatedScores,(e=>((0,i.uX)(),(0,i.CE)("div",{key:e.mile_excel_no,class:(0,s.C4)(["mx-auto mb-4 border-bottom p-4 input-base input-white list-wrapper",{activeDelete:v.deleteArray.includes(e)}]),onClick:t=>M.addDeleteArray(e),style:{width:"90%",height:"5em","box-shadow":"0 4px 8px rgba(0, 0, 0, 0.2)","background-color":"#FBFBFB"}},[(0,i.Lk)("div",E,[(0,i.Lk)("div",I,[M.isNew(e.mile_excel_date)?((0,i.uX)(),(0,i.CE)("div",A,P)):(0,i.Q3)("",!0),(0,i.Lk)("span",B,(0,s.v_)(e.mile_excel_file),1),(0,i.Lk)("span",F,(0,s.v_)(M.formatting(e.mile_excel_date)),1)]),(0,i.Lk)("button",{onClick:(0,n.D$)((t=>M.downloadExcel(e.mile_excel_file)),["stop"])},K,8,X)])],10,S)))),128))])):((0,i.uX)(),(0,i.CE)("div",$,H))])),M.showLoadButton?((0,i.uX)(),(0,i.CE)("div",z,[(0,i.Lk)("button",{onClick:t[2]||(t[2]=(...e)=>M.loadScores&&M.loadScores(...e)),class:"lg2",style:{"font-family":"'KB_C1'"}},[N,(0,i.eW)(" 더보기 ")])])):(0,i.Q3)("",!0),(0,i.Lk)("div",O,[(0,i.Lk)("div",Q,[(0,i.Lk)("div",V,[(0,i.Lk)("button",{onClick:t[3]||(t[3]=(...e)=>M.openModal&&M.openModal(...e)),class:"btn-green",style:{width:"8vw",height:"3vw","font-size":"1.2vw","font-family":"KB_C2"}},"등록하기")]),(0,i.Lk)("div",W,[(0,i.Lk)("button",{onClick:t[4]||(t[4]=(...e)=>M.deleteDocu&&M.deleteDocu(...e)),class:(0,s.C4)(["btn-gray",{choice:v.deleteArray.length>0}]),style:(0,s.Tr)([v.deleteArray.length>0?{"pointer-events":"auto"}:{"pointer-events":"none"},{width:"8vw",height:"3vw","font-size":"1.2vw","font-family":"KB_C2"}])}," 삭제하기 ",6)])])])]),v.isModalOpen?((0,i.uX)(),(0,i.CE)("div",T,[(0,i.Lk)("div",U,[(0,i.Lk)("span",{class:"close",onClick:t[5]||(t[5]=(...e)=>M.closeModal&&M.closeModal(...e))},"×"),(0,i.Lk)("div",null,[q,(0,i.Lk)("div",G,[(0,i.Lk)("div",J,[(0,i.Lk)("input",{type:"file",onChange:t[6]||(t[6]=(...e)=>M.onFileChange&&M.onFileChange(...e)),class:"lg2",style:{width:"90%","text-align":"right"}},null,32)])]),(0,i.Lk)("div",R,[(0,i.Lk)("button",{class:"btn-gray mt-2 KB_C2",onClick:t[7]||(t[7]=(...e)=>M.uploadFile&&M.uploadFile(...e)),style:{width:"8vw",height:"3vw","font-size":"1.2vw","font-family":"KB_C2"}}," 등록 ")])])],512)])):(0,i.Q3)("",!0)],64)}l(44114);var ee=l(66278),te=l(37682),le=l(95093),ie=l.n(le),se=l(66652),ne={name:"DocumentsMileageAdminView",components:{Datepicker:se.A},data(){return{isModalOpen:!1,file:null,selectedDate:null,deleteArray:[],baseHeight:1100,increment:90,buttonHeight:40,currentPage:1,itemsPerPage:7,allScores:[],countList:0}},computed:{...(0,ee.L8)("mile",["getMileInfo"]),...(0,ee.L8)("login",["getLoginInfo","getIsChecked"]),...(0,ee.L8)("mileExcel",["getArrayMileExcel"]),loginInfo(){return this.getLoginInfo},mileInfo(){return this.getMileInfo},arrayMileExcel(){return this.getArrayMileExcel},computedHeight(){let e=this.baseHeight+this.paginatedScores.length*this.increment;return this.paginatedScores.length%this.itemsPerPage===0&&this.paginatedScores.length,e+=this.buttonHeight/2,`${e}px`},filteredScores(){if(this.selectedDate){const e=this.formattingYear(this.selectedDate);return this.allScores.filter((t=>this.formattingYear(t.mile_excel_date)===e))}return this.allScores},paginatedScores(){return this.filteredScores.slice(0,this.currentPage*this.itemsPerPage)},showLoadButton(){const e=this.filteredScores.length%this.itemsPerPage===0,t=this.filteredScores.length>0,l=this.filteredScores.length!==this.countList;return e&&t&&l},isChecked(){return this.getIsChecked}},methods:{...(0,ee.i0)("mile",["fetchMileInfo","getMileDetail"]),...(0,ee.i0)("mileExcel",["fetchMileExcelInfo","downloadExcelSample","downloadFile","mileExcelLists","deleteMileExcel"]),openModal(){this.isModalOpen=!0},closeModal(){this.isModalOpen=!1},formatting(e){return ie()(e).format("YYYY-MM-DD HH:mm")},formattingYear(e){return ie()(e).format("YYYY-MM-DD")},isNew(e){const t=ie()(e),l=ie()(),i=ie()().subtract(7,"days");return t.isBetween(i,l,null,"[]")},async deleteDocu(){if(null!=this.deleteArray){const e=await this.deleteMileExcel(this.deleteArray);e&&e.data.success?(this.showAlert("마일리지 파일이 삭제되었습니다","success","#"),this.deleteArray=[]):this.showAlert("마일리지 파일 삭제가 실패했습니다","error","#")}},addDeleteArray(e){this.deleteArray.includes(e)?this.deleteArray=this.deleteArray.filter((t=>t!==e)):this.deleteArray.push(e)},downloadExcel(e){this.downloadFile({mile_excel_file:e})},downloadSample(){this.downloadExcelSample()},onFileChange(e){this.file=e.target.files[0]},async uploadFile(){const e=new FormData;e.append("file",this.file),e.append("mile_no",this.loginInfo?this.loginInfo.mile_no:null);try{const t=await te.A.post("/mileage/uploadExcel",e,{headers:{"Content-Type":"multipart/form-data"}});t.data.success?this.showAlert("마일리지 업로드 성공","success","#"):this.showAlert("마일리지 업로드 실패","error","#")}catch(t){this.showAlert("마일리지 업로드 실패","error","#")}},async fetchScoresByDate(){const e=await this.fetchMileExcelInfo({selectedDate:this.formattingYear(this.selectedDate),mile_no:this.loginInfo.mile_no,page:this.currentPage,itemsPerPage:this.itemsPerPage});this.allScores.push(...e.data),this.currentPage++},showAlert(e,t,l){this.$swal({title:e,icon:t,scrollbarPadding:!1}).then((e=>{e.isConfirmed&&("#"==l?location.reload():this.$router.push(l))}))},formatDate(e){const t=e.getFullYear(),l=String(e.getMonth()+1).padStart(2,"0"),i=String(e.getDate()).padStart(2,"0");return`${t}-${l}-${i}`},async loadScores(){if(this.selectedDate)await this.fetchScoresByDate();else{const e=await this.mileExcelLists({mile_no:this.loginInfo.mile_no,page:this.currentPage,itemsPerPage:this.itemsPerPage});this.allScores.push(...e.data),this.currentPage++;const t=this.loginInfo.mile_no,l=await te.A.get(`/mileage/countList/${t}`);this.countList=l.data}},checkLoginInfo(){this.getLoginInfo&&!1!==this.getIsChecked&&!1!==this.getLoginInfo.user_is_manager||(window.location.href="/noAccess")}},created(){this.checkLoginInfo();const e=this.loginInfo?this.loginInfo.user_no:null;e?this.mileInfo=this.fetchMileInfo(e):console.error("user_no이 유효하지 않습니다.");const t=this.loginInfo?this.loginInfo.mile_no:null;t?(this.getMileDetail(t),this.loadScores()):console.error("mile_no이 유효하지 않습니다.")}},ae=l(66262);const oe=(0,ae.A)(ne,[["render",Z]]);var re=oe}}]);
//# sourceMappingURL=1847.2f3c6cc8.js.map