"use strict";(self["webpackChunkmile"]=self["webpackChunkmile"]||[]).push([[6679],{6679:function(e,t,l){l.r(t),l.d(t,{default:function(){return ae}});var i=l(641),s=l(33),n=l(3751);const o={class:"bold-x-lg my-5",style:{"font-family":"KB_C3"}},a={class:"d-flex justify-content-end align-items-center",style:{"margin-top":"10vh","padding-left":"3%","padding-right":"3%"}},r={class:"d-flex justify-content-end align-items-center mt-3"},c={class:"md",style:{width:"95%","text-align":"right","margin-right":"3%","font-size":"14pt"}},d=(0,i.Lk)("span",{style:{"text-decoration":"underline"}},"엑셀 양식 다운로드",-1),h=(0,i.Lk)("i",{class:"bi bi-download lg2"},null,-1),g={key:0,class:"pr-5 pl-5 pb-5 pt-4",style:{"margin-top":"10vh"}},m=["onClick"],u={class:"d-flex align-items-center justify-content-between"},f={class:"d-flex justify-content-start align-items-center",style:{width:"80%"}},p={key:0,style:{"padding-left":"3%"}},y=(0,i.Lk)("span",{class:"md",style:{color:"#edbb00"}},"NEW",-1),k=[y],w={class:"lg2 pl-2 pr-2",style:{"margin-left":"3%","text-align":"left","font-family":"KB_C2"}},x={class:"md"},L=["onClick"],v=(0,i.Lk)("span",{class:"md",style:{"text-align":"right"}},"파일 다운로드 〉",-1),b=[v],_={key:1,class:"pr-5 pl-5 pb-5 pt-4",style:{"margin-top":"10vh"}},C={key:0},D=["onClick"],E={class:"d-flex align-items-center justify-content-between"},S={class:"d-flex justify-content-start align-items-center",style:{width:"80%"}},I={key:0,style:{"padding-left":"3%"}},A=(0,i.Lk)("span",{class:"md",style:{color:"#edbb00"}},"NEW",-1),M=[A],P={class:"lg2 pl-2 pr-2",style:{"margin-left":"3%","text-align":"left","font-family":"KB_C2"}},B={class:"md"},F=["onClick"],X=(0,i.Lk)("span",{class:"md",style:{"text-align":"right"}},"파일 다운로드 〉",-1),Y=[X],K={key:1},$=(0,i.Lk)("p",{class:"lg2",style:{"text-align":"center",color:"#aeaeb2","font-family":"KB_C2"}},"해당 날짜에 존재하는 마일리지 엑셀 파일이 없습니다.",-1),j=[$],H={key:2,style:{"margin-bottom":"3%"}},z=(0,i.Lk)("i",{class:"bi bi-arrow-clockwise lg2"},null,-1),N={class:"button-container mt-auto"},O={class:"d-flex justify-content-evenly mx-auto"},Q={class:"my-5"},V={class:"my-5"},W={key:0,class:"modals"},T={class:"modals-content",ref:"modal",style:{width:"40%",height:"45%","background-color":"#f9f9f9"}},U=(0,i.Lk)("p",{class:"text-left fw-bold mb-3",style:{"font-size":"19pt"}}," 마일리지 점수 업로드 ",-1),q={class:"p-4",style:{"margin-top":"5vh"}},G={class:"d-flex input-gray mt-3 p-4"},J={class:"d-flex justify-content-center",style:{"margin-top":"8vh"}};function R(e,t,l,y,v,A){const X=(0,i.g2)("Datepicker");return(0,i.uX)(),(0,i.CE)(i.FK,null,[(0,i.Lk)("div",{class:"cards page-back mx-auto",style:(0,s.Tr)({height:A.computedHeight})},[(0,i.Lk)("h2",o,(0,s.v_)(A.mileInfo?A.mileInfo.mile_no:"")+" 마일리지 점수",1),(0,i.Lk)("div",a,[(0,i.bF)(X,{modelValue:v.selectedDate,"onUpdate:modelValue":t[0]||(t[0]=e=>v.selectedDate=e),format:A.formatDate,style:{width:"25%"}},null,8,["modelValue","format"])]),(0,i.Lk)("div",r,[(0,i.Lk)("span",c,[(0,i.Lk)("button",{onClick:t[1]||(t[1]=(...e)=>A.downloadSample&&A.downloadSample(...e))},[d,(0,i.eW)("  "),h])])]),!v.selectedDate&&A.paginatedScores.length>0?((0,i.uX)(),(0,i.CE)("div",g,[((0,i.uX)(!0),(0,i.CE)(i.FK,null,(0,i.pI)(A.paginatedScores,(e=>((0,i.uX)(),(0,i.CE)("div",{key:e.mile_excel_no,class:(0,s.C4)(["mx-auto mb-4 border-bottom p-4 input-base input-white list-wrapper",{activeDelete:v.deleteArray.includes(e)}]),onClick:t=>A.addDeleteArray(e),style:{width:"90%",height:"5em","box-shadow":"0 4px 8px rgba(0, 0, 0, 0.2)","background-color":"#FBFBFB"}},[(0,i.Lk)("div",u,[(0,i.Lk)("div",f,[A.isNew(e.mile_excel_date)?((0,i.uX)(),(0,i.CE)("div",p,k)):(0,i.Q3)("",!0),(0,i.Lk)("span",w,(0,s.v_)(e.mile_excel_file),1),(0,i.Lk)("span",x,(0,s.v_)(A.formatting(e.mile_excel_date)),1)]),(0,i.Lk)("button",{onClick:(0,n.D$)((t=>A.downloadExcel(e.mile_excel_file)),["stop"])},b,8,L)])],10,m)))),128))])):((0,i.uX)(),(0,i.CE)("div",_,[A.paginatedScores.length>0?((0,i.uX)(),(0,i.CE)("div",C,[((0,i.uX)(!0),(0,i.CE)(i.FK,null,(0,i.pI)(A.paginatedScores,(e=>((0,i.uX)(),(0,i.CE)("div",{key:e.mile_excel_no,class:(0,s.C4)(["mx-auto mb-4 border-bottom p-4 input-base input-white list-wrapper",{activeDelete:v.deleteArray.includes(e)}]),onClick:t=>A.addDeleteArray(e),style:{width:"90%",height:"5em","box-shadow":"0 4px 8px rgba(0, 0, 0, 0.2)","background-color":"#FBFBFB"}},[(0,i.Lk)("div",E,[(0,i.Lk)("div",S,[A.isNew(e.mile_excel_date)?((0,i.uX)(),(0,i.CE)("div",I,M)):(0,i.Q3)("",!0),(0,i.Lk)("span",P,(0,s.v_)(e.mile_excel_file),1),(0,i.Lk)("span",B,(0,s.v_)(A.formatting(e.mile_excel_date)),1)]),(0,i.Lk)("button",{onClick:(0,n.D$)((t=>A.downloadExcel(e.mile_excel_file)),["stop"])},Y,8,F)])],10,D)))),128))])):((0,i.uX)(),(0,i.CE)("div",K,j))])),A.showLoadButton?((0,i.uX)(),(0,i.CE)("div",H,[(0,i.Lk)("button",{onClick:t[2]||(t[2]=(...e)=>A.loadScores&&A.loadScores(...e)),class:"lg2",style:{"font-family":"'KB_C1'"}},[z,(0,i.eW)(" 더보기 ")])])):(0,i.Q3)("",!0),(0,i.Lk)("div",N,[(0,i.Lk)("div",O,[(0,i.Lk)("div",Q,[(0,i.Lk)("button",{onClick:t[3]||(t[3]=(...e)=>A.openModal&&A.openModal(...e)),class:"btn-green",style:{width:"8vw",height:"3vw","font-size":"1.2vw","font-family":"KB_C2"}},"등록하기")]),(0,i.Lk)("div",V,[(0,i.Lk)("button",{onClick:t[4]||(t[4]=(...e)=>A.deleteDocu&&A.deleteDocu(...e)),class:(0,s.C4)(["btn-gray",{choice:v.deleteArray.length>0}]),style:(0,s.Tr)([v.deleteArray.length>0?{"pointer-events":"auto"}:{"pointer-events":"none"},{width:"8vw",height:"3vw","font-size":"1.2vw","font-family":"KB_C2"}])}," 삭제하기 ",6)])])])],4),v.isModalOpen?((0,i.uX)(),(0,i.CE)("div",W,[(0,i.Lk)("div",T,[(0,i.Lk)("span",{class:"close",onClick:t[5]||(t[5]=(...e)=>A.closeModal&&A.closeModal(...e))},"×"),(0,i.Lk)("div",null,[U,(0,i.Lk)("div",q,[(0,i.Lk)("div",G,[(0,i.Lk)("input",{type:"file",onChange:t[6]||(t[6]=(...e)=>A.onFileChange&&A.onFileChange(...e)),class:"lg2",style:{width:"90%","text-align":"right"}},null,32)])]),(0,i.Lk)("div",J,[(0,i.Lk)("button",{class:"btn-gray mt-2 KB_C2",onClick:t[7]||(t[7]=(...e)=>A.uploadFile&&A.uploadFile(...e)),style:{width:"8vw",height:"3vw","font-size":"1.2vw","font-family":"KB_C2"}}," 등록 ")])])],512)])):(0,i.Q3)("",!0)],64)}l(4114);var Z=l(6278),ee=l(7682),te=l(5093),le=l.n(te),ie=l(6652),se={name:"DocumentsMileageAdminView",components:{Datepicker:ie.A},data(){return{isModalOpen:!1,file:null,selectedDate:null,deleteArray:[],baseHeight:80,increment:10,buttonHeight:10,currentPage:1,itemsPerPage:7,allScores:[],countList:0}},computed:{...(0,Z.L8)("mile",["getMileInfo"]),...(0,Z.L8)("login",["getLoginInfo","getIsChecked"]),...(0,Z.L8)("mileExcel",["getArrayMileExcel"]),loginInfo(){return this.getLoginInfo},mileInfo(){return this.getMileInfo},arrayMileExcel(){return this.getArrayMileExcel},computedHeight(){let e=this.baseHeight+this.paginatedScores.length*this.increment;return this.paginatedScores.length%this.itemsPerPage===0&&this.paginatedScores.length,e+=this.buttonHeight/2,`${e}vh`},filteredScores(){if(this.selectedDate){const e=this.formattingYear(this.selectedDate);return this.allScores.filter((t=>this.formattingYear(t.mile_excel_date)===e))}return this.allScores},paginatedScores(){return this.filteredScores.slice(0,this.currentPage*this.itemsPerPage)},showLoadButton(){const e=this.filteredScores.length%this.itemsPerPage===0,t=this.filteredScores.length>0,l=this.filteredScores.length!==this.countList;return e&&t&&l},isChecked(){return this.getIsChecked}},methods:{...(0,Z.i0)("mile",["fetchMileInfo","getMileDetail"]),...(0,Z.i0)("mileExcel",["fetchMileExcelInfo","downloadExcelSample","downloadFile","mileExcelLists","deleteMileExcel"]),openModal(){this.isModalOpen=!0},closeModal(){this.isModalOpen=!1},formatting(e){return le()(e).format("YYYY-MM-DD HH:mm")},formattingYear(e){return le()(e).format("YYYY-MM-DD")},isNew(e){const t=le()(e),l=le()(),i=le()().subtract(7,"days");return t.isBetween(i,l,null,"[]")},async deleteDocu(){if(null!=this.deleteArray){const e=await this.deleteMileExcel(this.deleteArray);e&&e.data.success?(console.log("마일리지 엑셀 파일 삭제 완료"),this.showAlert("마일리지 파일이 삭제되었습니다","success","#"),this.deleteArray=[]):(console.log("마일리지 엑셀 파일 삭제 실패"),this.showAlert("마일리지 파일 삭제가 실패했습니다","error","#"))}},addDeleteArray(e){this.deleteArray.includes(e)?this.deleteArray=this.deleteArray.filter((t=>t!==e)):this.deleteArray.push(e),console.log("이건 삭제할 대상 배열",this.deleteArray)},downloadExcel(e){this.downloadFile({mile_excel_file:e})},downloadSample(){this.downloadExcelSample()},onFileChange(e){this.file=e.target.files[0]},async uploadFile(){const e=new FormData;e.append("file",this.file),e.append("mile_no",this.loginInfo?this.loginInfo.mile_no:null);try{const t=await ee.A.post("/mileage/uploadExcel",e,{headers:{"Content-Type":"multipart/form-data"}});t.data.success?this.showAlert("마일리지 업로드 성공","success","#"):this.showAlert("마일리지 업로드 실패","error","#")}catch(t){console.error("Error uploading file",t),this.showAlert("마일리지 업로드 실패","error","#")}},async fetchScoresByDate(){const e=await this.fetchMileExcelInfo({selectedDate:this.formattingYear(this.selectedDate),mile_no:this.loginInfo.mile_no,page:this.currentPage,itemsPerPage:this.itemsPerPage});this.allScores.push(...e.data),this.currentPage++},showAlert(e,t,l){this.$swal({title:e,icon:t,scrollbarPadding:!1}).then((e=>{e.isConfirmed&&("#"==l?location.reload():this.$router.push(l))}))},formatDate(e){const t=e.getFullYear(),l=String(e.getMonth()+1).padStart(2,"0"),i=String(e.getDate()).padStart(2,"0");return`${t}-${l}-${i}`},async loadScores(){if(this.selectedDate)await this.fetchScoresByDate();else{const e=await this.mileExcelLists({mile_no:this.loginInfo.mile_no,page:this.currentPage,itemsPerPage:this.itemsPerPage});this.allScores.push(...e.data),this.currentPage++;const t=this.loginInfo.mile_no,l=await ee.A.get(`/mileage/countList/${t}`);this.countList=l.data}},checkLoginInfo(){(!this.getLoginInfo||1==this.getLoginInfo.user_is_manager&&0==this.getIsChecked)&&(window.location.href="/noAccess")}},created(){this.checkLoginInfo();const e=this.loginInfo?this.loginInfo.user_no:null;e?this.mileInfo=this.fetchMileInfo(e):console.error("user_no이 유효하지 않습니다.");const t=this.loginInfo?this.loginInfo.mile_no:null;t?(this.getMileDetail(t),this.loadScores()):console.error("mile_no이 유효하지 않습니다.")}},ne=l(6262);const oe=(0,ne.A)(se,[["render",R]]);var ae=oe}}]);
//# sourceMappingURL=6679.fa1049ae.js.map