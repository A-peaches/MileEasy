"use strict";(self["webpackChunkmile"]=self["webpackChunkmile"]||[]).push([[5782],{5782:function(e,t,o){o.r(t),o.d(t,{default:function(){return x}});var i=o(641),n=o(3751),s=o(33);const l=e=>((0,i.Qi)("data-v-67f55eda"),e=e(),(0,i.jt)(),e),a={class:"app-container"},r={class:"content cards"},c={class:"header"},d={class:"button-container"},m=l((()=>(0,i.Lk)("span",{class:"arrow"},"❮",-1))),u=l((()=>(0,i.Lk)("div",{class:"actions"},[(0,i.Lk)("h1",{class:"title"},"공지사항 수정")],-1))),p={class:"form-group"},h=l((()=>(0,i.Lk)("label",{for:"title"},"제목",-1))),f=l((()=>(0,i.Lk)("label",{for:"category"},"카테고리",-1))),g={class:"drop-category"},k={class:"selected"},y={key:0,class:"dropdown-category",ref:"dropdownMenu"},_={class:"menu-items"},C=["onClick"],b=l((()=>(0,i.Lk)("div",null,[(0,i.Lk)("i",{class:"bi bi-caret-down-fill icon-right"})],-1))),L={class:"form-group content"},v=l((()=>(0,i.Lk)("label",{for:"content"},"내용",-1))),w={class:"form-group file-upload"},F=l((()=>(0,i.Lk)("label",{for:"file"},"첨부파일",-1))),N={class:"custom-file-upload"},I={key:0},$={class:"file-info"},A={key:1},E=l((()=>(0,i.Lk)("div",{class:"btn-yellow-container"},[(0,i.Lk)("button",{type:"submit",class:"btn-yellow"},"수정")],-1)));function U(e,t,o,l,U,B){return(0,i.uX)(),(0,i.CE)("div",a,[(0,i.Lk)("div",r,[(0,i.Lk)("div",c,[(0,i.Lk)("div",d,[(0,i.Lk)("button",{class:"back-button",onClick:t[0]||(t[0]=(...e)=>B.goBack&&B.goBack(...e))},[m,(0,i.eW)(" 이전 ")])])]),u,(0,i.Lk)("form",{onSubmit:t[8]||(t[8]=(0,n.D$)(((...e)=>B.submitForm&&B.submitForm(...e)),["prevent"]))},[(0,i.Lk)("div",p,[h,(0,i.bo)((0,i.Lk)("input",{type:"text",id:"title","onUpdate:modelValue":t[1]||(t[1]=e=>U.form.title=e),placeholder:"제목을 입력해주세요",class:"title-input"},null,512),[[n.Jo,U.form.title]])]),(0,i.Lk)("div",{class:"form-group",onClick:t[3]||(t[3]=(0,n.D$)(((...e)=>B.toggleCategory&&B.toggleCategory(...e)),["stop"])),ref:"categoryButton"},[f,(0,i.Lk)("div",g,[(0,i.Lk)("div",k,(0,s.v_)(U.selectedCategory||"마일리지를 선택해주세요"),1)]),U.showCategory?((0,i.uX)(),(0,i.CE)("div",y,[(0,i.Lk)("div",_,[((0,i.uX)(!0),(0,i.CE)(i.FK,null,(0,i.pI)(U.mileages,(e=>((0,i.uX)(),(0,i.CE)("a",{class:"dropdown-item",key:e.mile_no,onClick:t=>B.selectCategory(e.mile_no,e.mile_name,t)},(0,s.v_)(e.mile_name)+" 마일리지 ",9,C)))),128)),(0,i.Lk)("a",{class:"dropdown-item",onClick:t[2]||(t[2]=e=>B.selectCategory(null,"기타",e))},"기타")])],512)):(0,i.Q3)("",!0),b],512),(0,i.Lk)("div",L,[v,(0,i.bo)((0,i.Lk)("textarea",{id:"content","onUpdate:modelValue":t[4]||(t[4]=e=>U.form.content=e),placeholder:"내용을 입력해주세요"},null,512),[[n.Jo,U.form.content]])]),(0,i.Lk)("div",w,[F,(0,i.Lk)("div",N,[U.displayFileName?((0,i.uX)(),(0,i.CE)("div",I,[(0,i.Lk)("div",$,[(0,i.Lk)("span",null,(0,s.v_)(U.displayFileName),1),(0,i.Lk)("button",{onClick:t[5]||(t[5]=(...e)=>B.triggerFileInput&&B.triggerFileInput(...e)),type:"button",class:"file-modify-button"},"파일 수정")]),(0,i.Lk)("input",{type:"file",onChange:t[6]||(t[6]=(...e)=>B.handleFileUpload&&B.handleFileUpload(...e)),ref:"fileInput",style:{display:"none"}},null,544)])):((0,i.uX)(),(0,i.CE)("div",A,[(0,i.Lk)("input",{type:"file",onChange:t[7]||(t[7]=(...e)=>B.handleFileUpload&&B.handleFileUpload(...e)),ref:"fileInput"},null,544)]))])]),E],32)])])}o(4114);var B=o(7682),D=o(6278),M={name:"NoticeModifyAdminView",data(){return{form:{notice_board_no:"",title:"",mile_no:null,file:"",content:"",user_no:"",user_name:""},uploadedFileName:"",displayFileName:"",mileages:[],showCategory:!1,selectedCategory:null}},computed:{...(0,D.L8)("login",["getLoginInfo"]),decodedFileName(){if(this.uploadedFileName){const e=this.uploadedFileName.split("_",2);if(e.length>1)return decodeURIComponent(e[1])}return""}},mounted(){this.fetchNoticeDetails(),this.fetchMileages(),this.setUserInfo(),document.addEventListener("click",this.handleClickOutside)},beforeUnmount(){document.removeEventListener("click",this.handleClickOutside)},methods:{async handleFileUpload(e){const t=e.target.files[0];if(!t)return;const o=new FormData;o.append("files",t);try{const e=await B.A.post("/notice/upload",o,{headers:{"Content-Type":"multipart/form-data"}});console.log("서버 응답:",e.data);const[t,i]=e.data.split(",");console.log("저장된 파일명:",t),console.log("원본 파일명:",i),this.uploadedFileName=t,this.displayFileName=i,this.form.file=t}catch(i){console.error("파일 업로드 중 오류 발생:",i),this.showAlert("파일 업로드 중 오류가 발생했습니다.","error")}},getDisplayFileName(e){const t=37;return!e||e.length<=t?e:"_"===e.charAt(t-1)?e.substring(t):e},async submitForm(){const e=new FormData;e.append("notice_board_no",this.form.notice_board_no),e.append("notice_board_title",this.form.title),e.append("mile_name",this.selectedCategory),e.append("notice_board_content",this.form.content),e.append("user_no",this.form.user_no),e.append("user_name",this.form.user_name),this.form.file?(e.append("file",this.form.file),e.append("originalFileName",this.displayFileName)):this.displayFileName&&e.append("originalFileName",this.displayFileName);for(let[o,i]of e.entries())console.log(`${o}: ${i}`);try{const t=await B.A.post("/notice/update",e,{headers:{"Content-Type":"multipart/form-data"}});console.log("서버 응답:",t.data),200===t.status?(this.showAlert("공지사항이 수정되었습니다.","success"),this.$router.push("/noticeListView")):this.showAlert("공지사항 수정 중 오류가 발생했습니다.","error")}catch(t){console.error("Error submitting form:",t),this.showAlert("공지사항 수정 중 오류가 발생했습니다.","error")}},goBack(){this.$router.go(-1)},toggleCategory(){this.showCategory=!this.showCategory},selectCategory(e,t,o){o&&o.stopPropagation(),this.selectedCategory=t,this.form.mile_no=null===e?"기타":e,this.showCategory=!1},handleClickOutside(e){this.$refs.dropdownMenu&&!this.$refs.dropdownMenu.contains(e.target)&&this.$refs.categoryButton&&!this.$refs.categoryButton.contains(e.target)&&(this.showCategory=!1)},triggerFileInput(){const e=this.$refs.fileInput;e?e.click():console.error("fileInput reference is not available.")},setUserInfo(){const e=this.getLoginInfo;e&&(this.form.user_no=e.user_no,this.form.user_name=e.user_name)},fetchNoticeDetails(){const e=this.$route.params.id;B.A.get(`/notice/${e}`).then((e=>{const t=e.data;this.form.notice_board_no=t.notice_board_no,this.form.title=t.notice_board_title,this.form.mile_no=t.mile_no,this.originalMileNo=t.mile_no,this.selectedCategory=null===t.mile_no?"기타":t.mile_name,this.form.content=t.notice_board_content,this.displayFileName=t.notice_board_file,console.log("detail 에서 정보 가지고 오기.:",t),console.log("수정 카테고리 로그",this.selectedCategory)})).catch((e=>{console.error("Error fetching notice details:",e.response?e.response.data:e.message)}))},async fetchMileages(){try{const e=await B.A.get("/notice/mileage");this.mileages=e.data}catch(e){console.error("Error fetching mileages:",e.response?e.response.data:e.message)}},showAlert(e,t){this.$swal({title:e,icon:t,confirmButtonText:"확인",confirmButtonColor:"#4b4a4a"})}}},X=o(6262);const V=(0,X.A)(M,[["render",U],["__scopeId","data-v-67f55eda"]]);var x=V}}]);
//# sourceMappingURL=5782.78910ebe.js.map