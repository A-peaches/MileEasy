"use strict";(self["webpackChunkmile"]=self["webpackChunkmile"]||[]).push([[7285],{67285:function(e,t,n){n.r(t),n.d(t,{default:function(){return q}});var s=n(20641),i=n(90033),l=n(53751);const o={class:"cards page-back mx-auto"},a={class:"bold-x-lg my-5",style:{"font-family":"KB_C3"}},c={class:"d-flex justify-content-between align-items-center"},r={class:"lg2",style:{padding:"3em"}},u={class:"input-search input-base",style:{"margin-right":"2em",width:"17vw",height:"6vh"}},d={class:"d-flex justify-content-between align-items-center",style:{"font-size":"14pt",height:"100%","margin-left":"1em"}},h=(0,s.Lk)("button",null,[(0,s.Lk)("i",{class:"bi bi-search mr-2",style:{"font-size":"25px",color:"#4b4a4a"}})],-1),m={key:0,class:"pr-5 pl-5 pb-5 pt-4",style:{"margin-top":"10vh"}},g=["onClick"],f={class:"d-flex align-items-center justify-content-between"},p={style:{width:"80%","text-align":"left"}},y={class:"d-flex align-items-center justify-content-start"},k={key:0,style:{width:"5%","padding-left":"3%"}},w=(0,s.Lk)("span",{class:"md",style:{color:"#edbb00"}},"NEW",-1),D=[w],L={class:"d-flex align-items-center justify-content-between",style:{width:"100%"}},b={class:"lg2 pl-5",style:{"margin-left":"3%","text-align":"left","font-family":"KB_C2"}},v={class:"md pl-3",style:{width:"15%","margin-right":"2%","text-align":"right","font-family":"KB_C3"}},C=["onClick"],I=(0,s.Lk)("span",{class:"md",style:{"text-align":"right"}},"파일 다운로드 〉",-1),_=[I],x={key:1,style:{"padding-top":"10vh"}},A=(0,s.Lk)("p",{class:"lg2",style:{"text-align":"center",color:"#aeaeb2","font-family":"KB_C2"}},"검색 결과가 없습니다.",-1),M=[A],P={key:2,style:{"margin-bottom":"3%"}},B=(0,s.Lk)("i",{class:"bi bi-arrow-clockwise lg2"},null,-1),E={class:"button-container mt-auto"},S={class:"d-flex justify-content-evenly mx-auto"},K={class:"mt-5"},F={class:"mt-5"},Q={key:0,class:"modals"},X={class:"modals-content",ref:"modal",style:{width:"40%",height:"45%","background-color":"#f9f9f9"}},j=(0,s.Lk)("p",{class:"text-left fw-bold mb-3",style:{"font-size":"19pt"}}," 마일리지 문서 업로드 ",-1),T={class:"p-4",style:{"margin-top":"5vh"}},z={class:"d-flex input-gray mt-3 p-4"},H={class:"d-flex justify-content-center",style:{"margin-top":"8vh"}};function $(e,t,n,w,I,A){return(0,s.uX)(),(0,s.CE)(s.FK,null,[(0,s.Lk)("div",o,[(0,s.Lk)("h2",a,(0,i.v_)(A.mileInfo?A.mileInfo.mile_no:"")+" 마일리지 문서",1),(0,s.Lk)("div",c,[(0,s.Lk)("div",r,"총 "+(0,i.v_)(A.documentSum)+"건",1),(0,s.Lk)("div",u,[(0,s.Lk)("div",d,[(0,s.bo)((0,s.Lk)("input",{type:"text","onUpdate:modelValue":t[0]||(t[0]=e=>I.searchQuery=e),onInput:t[1]||(t[1]=(...e)=>A.onSearch&&A.onSearch(...e)),placeholder:"검색어를 입력하세요",class:"w-100 h-100 d-inline-block",style:{"text-align":"left"}},null,544),[[l.Jo,I.searchQuery]]),h])])]),A.filteredDocuments.length>0?((0,s.uX)(),(0,s.CE)("div",m,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(A.paginatedDocuments,(e=>((0,s.uX)(),(0,s.CE)("div",{key:e.documnet_mile_no,class:(0,i.C4)(["mx-auto mb-4 border-bottom p-4 input-base input-white list-wrapper",{activeDelete:I.deleteArray.includes(e)}]),onClick:t=>A.addDeleteDocuArray(e),style:{width:"90%",height:"5em","box-shadow":"0 4px 8px rgba(0, 0, 0, 0.2)","background-color":"#FBFBFB"}},[(0,s.Lk)("div",f,[(0,s.Lk)("button",p,[(0,s.Lk)("div",y,[A.isNew(e.document_date)?((0,s.uX)(),(0,s.CE)("div",k,D)):(0,s.Q3)("",!0),(0,s.Lk)("div",L,[(0,s.Lk)("span",b,(0,i.v_)(e.document_file),1),(0,s.Lk)("span",v,(0,i.v_)(A.formatDate(e.document_date)),1)])])]),(0,s.Lk)("button",{onClick:(0,l.D$)((t=>A.downloadDocu(e.document_file)),["stop"])},_,8,C)])],10,g)))),128))])):((0,s.uX)(),(0,s.CE)("div",x,M)),A.showLoadButton?((0,s.uX)(),(0,s.CE)("div",P,[(0,s.Lk)("button",{onClick:t[2]||(t[2]=(...e)=>A.loadDocuments&&A.loadDocuments(...e)),class:"lg2",style:{"font-family":"'KB_C1'"}},[B,(0,s.eW)(" 더보기 ")])])):(0,s.Q3)("",!0),(0,s.Lk)("div",E,[(0,s.Lk)("div",S,[(0,s.Lk)("div",K,[(0,s.Lk)("button",{onClick:t[3]||(t[3]=(...e)=>A.openModal&&A.openModal(...e)),class:"btn-green",style:{width:"8vw",height:"3vw","font-size":"1.2vw","font-family":"KB_C2"}},"등록하기")]),(0,s.Lk)("div",F,[(0,s.Lk)("button",{onClick:t[4]||(t[4]=(...e)=>A.deleteDocu&&A.deleteDocu(...e)),class:(0,i.C4)(["btn-gray button-style",{choice:I.deleteArray.length>0}]),style:(0,i.Tr)(I.deleteArray.length>0?{"pointer-events":"auto"}:{"pointer-events":"none"})}," 삭제하기 ",6)])])])]),I.isModalOpen?((0,s.uX)(),(0,s.CE)("div",Q,[(0,s.Lk)("div",X,[(0,s.Lk)("span",{class:"close",onClick:t[5]||(t[5]=(...e)=>A.closeModal&&A.closeModal(...e))},"×"),(0,s.Lk)("div",null,[j,(0,s.Lk)("div",T,[(0,s.Lk)("div",z,[(0,s.Lk)("input",{type:"file",onChange:t[6]||(t[6]=(...e)=>A.onFileChange&&A.onFileChange(...e)),class:"lg2",style:{width:"90%","text-align":"right"}},null,32)])]),(0,s.Lk)("div",H,[(0,s.Lk)("button",{class:"btn-gray mt-2 KB_C2",onClick:t[7]||(t[7]=(...e)=>A.uploadDocument&&A.uploadDocument(...e)),style:{width:"8vw",height:"3vw","font-size":"1.2vw","font-family":"KB_C2"}}," 등록 ")])])],512)])):(0,s.Q3)("",!0)],64)}n(44114);var O=n(66278),Y=n(37682),N=n(95093),V=n.n(N),W={name:"DocumentsMileageAdminView",data(){return{isModalOpen:!1,file:null,deleteArray:[],baseHeight:1100,increment:90,buttonHeight:40,searchQuery:"",currentPage:1,itemsPerPage:7,allDocuments:[],countList:0,lastInputTime:0}},computed:{...(0,O.L8)("mile",["getMileInfo"]),...(0,O.L8)("login",["getLoginInfo","getIsChecked"]),...(0,O.L8)("mileExcel",["getArrayMileDocument","getDocumentSum"]),loginInfo(){return this.getLoginInfo},mileInfo(){return this.getMileInfo},arrayMileDocument(){return this.getArrayMileDocument},computedHeight(){let e=this.baseHeight+this.paginatedDocuments.length*this.increment;return this.paginatedDocuments.length%this.itemsPerPage===0&&this.paginatedDocuments.length,e+=this.buttonHeight/2,`${e}px`},documentSum(){return this.getDocumentSum},filteredDocuments(){return this.allDocuments.filter((e=>e.document_file.includes(this.searchQuery)))},paginatedDocuments(){return this.filteredDocuments.slice(0,this.currentPage*this.itemsPerPage)},showLoadButton(){const e=this.filteredDocuments.length%this.itemsPerPage===0,t=this.filteredDocuments.length>0,n=this.filteredDocuments.length!==this.countList;return e&&t&&n},isChecked(){return this.getIsChecked}},methods:{...(0,O.i0)("mile",["fetchMileInfo","getMileDetail"]),...(0,O.i0)("mileExcel",["mileDocumentLists","downloadDocument","deleteMileDocument","getMileDocumentSum"]),openModal(){this.isModalOpen=!0},closeModal(){this.isModalOpen=!1},formatDate(e){return V()(e).format("YYYY-MM-DD")},isNew(e){const t=V()(e),n=V()(),s=V()().subtract(7,"days");return t.isBetween(s,n,null,"[]")},showAlert(e,t,n){this.$swal({title:e,icon:t,scrollbarPadding:!1}).then((e=>{e.isConfirmed&&("#"==n?location.reload():this.$router.push(n))}))},onFileChange(e){this.file=e.target.files[0]},async uploadDocument(){const e=new FormData;e.append("file",this.file),e.append("mile_no",this.loginInfo?this.loginInfo.mile_no:null);try{const t=await Y.A.post("/mileage/uploadDocument",e,{headers:{"Content-Type":"multipart/form-data"}});t.data.success?this.showAlert("마일리지 문서 업로드 성공","success","#"):this.showAlert("마일리지 문서 업로드 실패","error","#")}catch(t){console.error("Error uploading document",t),console.log("이건 에러 상태 response status:",t.response.status),t.response&&409===t.response.status?this.showAlert("중복된 파일명이 있습니다","info","#"):this.showAlert("마일리지 문서 업로드 실패","error","#")}},downloadDocu(e){this.downloadDocument({document_file:e})},addDeleteDocuArray(e){this.deleteArray.includes(e)?this.deleteArray=this.deleteArray.filter((t=>t!==e)):(this.deleteArray.push(e),console.log(this.deleteArray))},async deleteDocu(){if(null!=this.deleteArray){const e=await this.deleteMileDocument(this.deleteArray);e&&e.data.success?(console.log("마일리지 문서 파일 삭제 완료"),this.showAlert("마일리지 문서가 삭제되었습니다","success","#"),this.deleteArray=[]):(console.log("마일리지 문서 파일 삭제 실패"),this.showAlert("마일리지 문서 삭제가 실패했습니다","error","#"))}},async loadDocuments(){const e=await this.mileDocumentLists({mile_no:this.loginInfo.mile_no,page:this.currentPage,itemsPerPage:this.itemsPerPage});this.allDocuments.push(...e.data),this.currentPage++;const t=this.loginInfo.mile_no,n=await Y.A.get(`/mileage/countListDocuments/${t}`);this.listSum=n.data},onSearch(){const e=Date.now(),t=e-this.lastInputTime;t>500&&(this.lastInputTime=e,this.loadDocuments())},checkLoginInfo(){(!this.getLoginInfo||1==this.getLoginInfo.user_is_manager&&0==this.getIsChecked)&&(window.location.href="/noAccess")}},created(){this.checkLoginInfo();const e=this.loginInfo?this.loginInfo.user_no:null;e?this.mileInfo=this.fetchMileInfo(e):console.error("user_no이 유효하지 않습니다.");const t=this.loginInfo?this.loginInfo.mile_no:null;t?(this.getMileDetail(t),this.loadDocuments(),this.getMileDocumentSum(t)):console.error("mile_no이 유효하지 않습니다.")},watch:{searchQuery(){this.lastInputTime=Date.now(),this.onSearch()}}},J=n(66262);const U=(0,J.A)(W,[["render",$]]);var q=U}}]);
//# sourceMappingURL=7285.95721334.js.map