"use strict";(self["webpackChunkmile"]=self["webpackChunkmile"]||[]).push([[2847],{2847:function(e,t,o){o.r(t),o.d(t,{default:function(){return V}});var i=o(641),n=o(3751),s=o(33);const l=e=>((0,i.Qi)("data-v-e3c1307e"),e=e(),(0,i.jt)(),e),a={class:"app-container"},r={class:"content cards"},c={class:"header"},d={class:"button-container"},m=l((()=>(0,i.Lk)("span",{class:"arrow"},"❮",-1))),p=l((()=>(0,i.Lk)("div",{class:"actions"},[(0,i.Lk)("h1",{class:"title"},"M-Tip 수정")],-1))),u={class:"form-group"},h=l((()=>(0,i.Lk)("label",{for:"title"},"제목",-1))),f=l((()=>(0,i.Lk)("label",{for:"category"},"카테고리",-1))),g={class:"drop-category"},_={class:"selected"},y={key:0,class:"dropdown-category",ref:"dropdownMenu"},k={class:"menu-items"},b=["onClick"],C=l((()=>(0,i.Lk)("div",null,[(0,i.Lk)("i",{class:"bi bi-caret-down-fill icon-right"})],-1))),L={class:"form-group content"},v=l((()=>(0,i.Lk)("label",{for:"content"},"내용",-1))),w={class:"form-group file-upload"},F=l((()=>(0,i.Lk)("label",{for:"file"},"첨부파일",-1))),N={class:"custom-file-upload"},I={key:0},$={class:"file-info"},A={key:1},D=l((()=>(0,i.Lk)("div",{class:"btn-yellow-container"},[(0,i.Lk)("button",{type:"submit",class:"btn-yellow"},"수정")],-1)));function E(e,t,o,l,E,U){return(0,i.uX)(),(0,i.CE)("div",a,[(0,i.Lk)("div",r,[(0,i.Lk)("div",c,[(0,i.Lk)("div",d,[(0,i.Lk)("button",{class:"back-button",onClick:t[0]||(t[0]=(...e)=>U.goBack&&U.goBack(...e))},[m,(0,i.eW)(" 이전 ")])])]),p,(0,i.Lk)("form",{onSubmit:t[8]||(t[8]=(0,n.D$)(((...e)=>U.submitForm&&U.submitForm(...e)),["prevent"]))},[(0,i.Lk)("div",u,[h,(0,i.bo)((0,i.Lk)("input",{type:"text",id:"title","onUpdate:modelValue":t[1]||(t[1]=e=>E.form.title=e),placeholder:"제목을 입력해주세요",class:"title-input"},null,512),[[n.Jo,E.form.title]])]),(0,i.Lk)("div",{class:"form-group",onClick:t[3]||(t[3]=(0,n.D$)(((...e)=>U.toggleCategory&&U.toggleCategory(...e)),["stop"])),ref:"categoryButton"},[f,(0,i.Lk)("div",g,[(0,i.Lk)("div",_,(0,s.v_)(E.selectedCategory||"마일리지를 선택해주세요"),1)]),E.showCategory?((0,i.uX)(),(0,i.CE)("div",y,[(0,i.Lk)("div",k,[((0,i.uX)(!0),(0,i.CE)(i.FK,null,(0,i.pI)(E.mileages,(e=>((0,i.uX)(),(0,i.CE)("a",{class:"dropdown-item",key:e.mile_no,onClick:t=>U.selectCategory(e.mile_no,e.mile_name,t)},(0,s.v_)(e.mile_name)+" 마일리지 ",9,b)))),128)),(0,i.Lk)("a",{class:"dropdown-item",onClick:t[2]||(t[2]=e=>U.selectCategory(null,"기타",e))},"기타")])],512)):(0,i.Q3)("",!0),C],512),(0,i.Lk)("div",L,[v,(0,i.bo)((0,i.Lk)("textarea",{id:"content","onUpdate:modelValue":t[4]||(t[4]=e=>E.form.content=e),placeholder:"내용을 입력해주세요"},null,512),[[n.Jo,E.form.content]])]),(0,i.Lk)("div",w,[F,(0,i.Lk)("div",N,[E.displayFileName?((0,i.uX)(),(0,i.CE)("div",I,[(0,i.Lk)("div",$,[(0,i.Lk)("span",null,(0,s.v_)(E.displayFileName),1),(0,i.Lk)("button",{onClick:t[5]||(t[5]=(...e)=>U.triggerFileInput&&U.triggerFileInput(...e)),type:"button",class:"file-modify-button"},"파일 수정")]),(0,i.Lk)("input",{type:"file",onChange:t[6]||(t[6]=(...e)=>U.handleFileUpload&&U.handleFileUpload(...e)),ref:"fileInput",style:{display:"none"}},null,544)])):((0,i.uX)(),(0,i.CE)("div",A,[(0,i.Lk)("input",{type:"file",onChange:t[7]||(t[7]=(...e)=>U.handleFileUpload&&U.handleFileUpload(...e)),ref:"fileInput"},null,544)]))])]),D],32)])])}o(4114);var U=o(7682),M=o(6278),B={name:"NoticeModifyAdminView",props:["mtip_board_no"],data(){return{form:{notice_board_no:"",title:"",mile_no:null,file:"",content:"",user_no:"",user_name:""},uploadedFileName:"",displayFileName:"",mileages:[],showCategory:!1,selectedCategory:null}},computed:{...(0,M.L8)("login",["getLoginInfo"]),decodedFileName(){if(this.uploadedFileName){const e=this.uploadedFileName.split("_",2);if(e.length>1)return decodeURIComponent(e[1])}return""}},async mounted(){const e=this.$route.params.mtip_board_no;console.log("Notice ID:",e),e?await this.fetchNoticeDetails(e):console.error("No notice ID provided"),await this.fetchMileages(),this.setUserInfo(),document.addEventListener("click",this.handleClickOutside)},beforeUnmount(){document.removeEventListener("click",this.handleClickOutside)},methods:{...(0,M.i0)("mtipBoard",["fetchNoticeDetail"]),async handleFileUpload(e){const t=e.target.files[0];if(!t)return;const o=new FormData;o.append("files",t);try{const e=await U.A.post("/mtip/upload",o,{headers:{"Content-Type":"multipart/form-data"}});console.log("서버 응답:",e.data);const[t,i]=e.data.split(",");console.log("저장된 파일명:",t),console.log("원본 파일명:",i),this.uploadedFileName=t,this.displayFileName=i,this.form.file=t}catch(i){console.error("파일 업로드 중 오류 발생:",i),this.showAlert("파일 업로드 중 오류가 발생했습니다.","error")}},getDisplayFileName(e){const t=37;return!e||e.length<=t?e:"_"===e.charAt(t-1)?e.substring(t):e},async submitForm(){const e=new FormData;e.append("mtip_board_no",this.form.notice_board_no),e.append("mtip_board_title",this.form.title),e.append("mile_name",this.selectedCategory),e.append("mtip_board_content",this.form.content),e.append("user_no",this.form.user_no),e.append("user_name",this.form.user_name),this.form.file?(e.append("file",this.form.file),e.append("originalFileName",this.displayFileName)):this.displayFileName&&e.append("originalFileName",this.displayFileName);for(let[o,i]of e.entries())console.log(`${o}: ${i}`);try{const t=await U.A.post("/mtip/update",e,{headers:{"Content-Type":"multipart/form-data"}});console.log("서버 응답:",t.data),200===t.status?(this.showAlert("공지사항이 수정되었습니다.","success"),this.$router.push("/M_TipListView")):this.showAlert("공지사항 수정 중 오류가 발생했습니다.","error")}catch(t){console.error("Error submitting form:",t),this.showAlert("공지사항 수정 중 오류가 발생했습니다.","error")}},goBack(){this.$router.go(-1)},toggleCategory(){this.showCategory=!this.showCategory},selectCategory(e,t,o){o&&o.stopPropagation(),this.selectedCategory=t,this.form.mile_no=null===e?"기타":e,this.showCategory=!1},handleClickOutside(e){this.$refs.dropdownMenu&&!this.$refs.dropdownMenu.contains(e.target)&&this.$refs.categoryButton&&!this.$refs.categoryButton.contains(e.target)&&(this.showCategory=!1)},triggerFileInput(){const e=this.$refs.fileInput;e?e.click():console.error("fileInput reference is not available.")},setUserInfo(){const e=this.getLoginInfo;e&&(this.form.user_no=e.user_no,this.form.user_name=e.user_name)},async fetchNoticeDetails(e){try{console.log("noticeId:",e);const t=await this.fetchNoticeDetail(e);if(console.log("Full response:",t),!t||!t.data)return void console.error("Invalid response structure");const o=t.data;console.log("Notice data:",o),void 0!==o.mtip_board_no?(this.form.notice_board_no=o.mtip_board_no,console.log("this.form.notice_board_no:",this.form.notice_board_no)):console.error("mtip_board_no is undefined in the response"),this.form.notice_board_no=o.mtip_board_no,console.log("this.form.notice_board_no:",this.form.notice_board_no),this.form.title=o.mtip_board_title,this.form.mile_no=o.mile_no,this.originalMileNo=o.mile_no,this.selectedCategory=null===o.mile_no?"기타":o.mile_name,this.form.content=o.mtip_board_content,this.displayFileName=o.mtip_board_file,console.log("Fetched notice details:",o),console.log("Selected category:",this.selectedCategory)}catch(t){console.error("Error fetching notice details:",t)}},async fetchMileages(){try{const e=await U.A.get("/notice/mileage");this.mileages=e.data}catch(e){console.error("Error fetching mileages:",e.response?e.response.data:e.message)}},showAlert(e,t){this.$swal({title:e,icon:t,scrollbarPadding:!1})}}},X=o(6262);const T=(0,X.A)(B,[["render",E],["__scopeId","data-v-e3c1307e"]]);var V=T}}]);
//# sourceMappingURL=2847.a8a191f7.js.map