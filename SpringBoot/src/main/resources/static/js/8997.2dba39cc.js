"use strict";(self["webpackChunkmile"]=self["webpackChunkmile"]||[]).push([[8997],{8997:function(t,e,a){a.r(e),a.d(e,{default:function(){return se}});var s=a(20641),i=a(90033);const o=t=>((0,s.Qi)("data-v-bf6ffd8a"),t=t(),(0,s.jt)(),t),n={class:"cards page-back mx-auto"},r={class:"bold-x-lg mt-5 mb-4",style:{"font-family":"KB_C3"}},l={key:0,class:"help-popover",ref:"helpPopover"},d=o((()=>(0,s.Lk)("div",{style:{"font-size":"12pt"}},[(0,s.Lk)("span",null," 그룹 목표 100% 달성 시 마왕 점수가 상승하고, 개인 목표로 성장을 계획하세요. ")],-1))),c=[d],g={class:"input-base input-search d-flex justify-content-center mx-auto my-5",style:{width:"600px",background:"#ebebeb"}};function p(t,e,a,o,d,p){return(0,s.uX)(),(0,s.CE)("div",n,[(0,s.Lk)("h2",r,[(0,s.eW)(" 목표설정 "),(0,s.Lk)("i",{class:"bi bi-question-circle help-icon",onClick:e[0]||(e[0]=(...t)=>p.toggleHelpPopover&&p.toggleHelpPopover(...t)),style:{"font-size":"20pt"},ref:"helpIcon"},null,512)]),d.showHelpPopover?((0,s.uX)(),(0,s.CE)("div",l,c,512)):(0,s.Q3)("",!0),(0,s.Lk)("div",g,[(0,s.Lk)("button",{class:(0,i.C4)(["tab-container lg2 fw-bold",{active:"together"===d.activeTab}]),onClick:e[1]||(e[1]=t=>p.setActiveTab("together"))}," 참여형 ",2),(0,s.Lk)("button",{class:(0,i.C4)(["tab-container lg2 fw-bold",{active:"personal"===d.activeTab}]),onClick:e[2]||(e[2]=t=>p.setActiveTab("personal"))}," 개인형 ",2)]),((0,s.uX)(),(0,s.Wv)((0,s.$y)(p.currentComponent),{onDataLoaded:t.handleDataLoaded,class:"my-5"},null,40,["onDataLoaded"]))])}a(44114);var u=a(53751);const h=t=>((0,s.Qi)("data-v-1f18016a"),t=t(),(0,s.jt)(),t),m={key:0,style:{"font-size":"20px","text-align":"center","margin-top":"20px"}},f=h((()=>(0,s.Lk)("i",{class:"bi bi-arrow-clockwise"},null,-1))),y={class:"d-flex justify-content-start align-items-center mb-5",style:{"margin-left":"5%"}},k={style:{display:"flex","align-items":"center"}},v={class:"count"},b={class:"radio-container p-3 lg2"},L=h((()=>(0,s.Lk)("label",{class:"radio-label",for:"finished"},[(0,s.Lk)("span",{class:"custom-radio"}),(0,s.eW)(" 종료 ")],-1))),T={class:"radio-container p-3 lg2"},_=h((()=>(0,s.Lk)("label",{class:"radio-label",for:"notFinished"},[(0,s.Lk)("span",{class:"custom-radio"}),(0,s.eW)(" 참여 ")],-1))),w={class:"radio-container p-3 lg2"},x=h((()=>(0,s.Lk)("label",{class:"radio-label",for:"notjoin"},[(0,s.Lk)("span",{class:"custom-radio"}),(0,s.eW)(" 미참여 ")],-1))),C={key:1,class:"row"},P={class:"p-3"},D={class:"py-3",style:{display:"flex","align-items":"center","justify-content":"space-between","margin-bottom":"-10px"}},E={style:{display:"flex","align-items":"center",flex:"1"}},B={style:{"text-align":"left","margin-left":"10px","margin-top":"10px","font-weight":"bold","font-family":"KB_C2","font-size":"13pt"},class:"mb-2"},S={style:{display:"flex","align-items":"center","justify-content":"flex-end",width:"100px",position:"relative",overflow:"hidden"}},I={key:0,class:"participation-info"},A=["onClick"],F=h((()=>(0,s.Lk)("i",{class:"bi bi-person-vcard",style:{"margin-right":"12px","margin-bottom":"2px","font-size":"25px",color:"#8c8c8c"}},null,-1))),M={style:{"margin-right":"25px"}},U=["onClick"],X={key:2,class:"join-button",disabled:""},$={key:3,class:"join-button",disabled:""},j={class:"py-3",style:{display:"flex","flex-direction":"column","align-items":"flex-start","margin-left":"20px"}},N=h((()=>(0,s.Lk)("span",{class:"lg2",style:{"font-family":"'KB_C1'","font-size":"20px","margin-bottom":"-25px"}},"그룹 달성률",-1))),R=h((()=>(0,s.Lk)("br",null,null,-1))),K={style:{display:"flex","justify-content":"space-between","align-items":"center",width:"100%"}},V={class:"progress",role:"progressbar","aria-label":"Animated striped example","aria-valuenow":"60","aria-valuemin":"0","aria-valuemax":"100",style:{width:"80%","margin-right":"10px"}},z={style:{"font-weight":"bold","white-space":"nowrap","font-family":"'KB_C2'","font-size":"25px","margin-right":"10px"}},O={class:"md",style:{"margin-top":"5px","font-size":"13px","font-family":"'KB_C2'"}},H=h((()=>(0,s.Lk)("span",{class:"lg2",style:{"font-family":"'KB_C1'","font-size":"17px"}}," 🎯 나의 마일리지 / 목표 마일리지 ",-1))),Q={class:"py-3"},W={class:"bold-x-lg",style:{"font-family":"'KB_C1'"}},q={class:"highlight-score"};function J(t,e,a,o,n,r){return(0,s.uX)(),(0,s.CE)("div",null,[n.isLoading?((0,s.uX)(),(0,s.CE)("div",m,[f,(0,s.eW)(" 로딩 중... ")])):(0,s.Q3)("",!0),(0,s.Lk)("div",y,[(0,s.Lk)("div",k,[(0,s.Lk)("span",v," 총 "+(0,i.v_)(r.totalTargetsCount)+"건 ",1)]),(0,s.Lk)("div",b,[(0,s.bo)((0,s.Lk)("input",{class:"radio-input",type:"radio",name:"targetList",id:"finished",value:"finished","onUpdate:modelValue":e[0]||(e[0]=t=>n.sortBy=t)},null,512),[[u.XL,n.sortBy]]),L]),(0,s.Lk)("div",T,[(0,s.bo)((0,s.Lk)("input",{class:"radio-input",type:"radio",name:"targetList",id:"notFinished",value:"not-finished","onUpdate:modelValue":e[1]||(e[1]=t=>n.sortBy=t)},null,512),[[u.XL,n.sortBy]]),_]),(0,s.Lk)("div",w,[(0,s.bo)((0,s.Lk)("input",{class:"radio-input",type:"radio",name:"targetList",id:"notjoin",value:"notjoin","onUpdate:modelValue":e[2]||(e[2]=t=>n.sortBy=t)},null,512),[[u.XL,n.sortBy]]),x])]),n.isLoading?(0,s.Q3)("",!0):((0,s.uX)(),(0,s.CE)("div",C,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(r.displayedTargets,((t,a)=>((0,s.uX)(),(0,s.CE)("div",{key:t.target_no,class:"col-md-4 mb-3 fade-up-item"},[(0,s.Lk)("div",P,[(0,s.Lk)("div",{style:(0,i.Tr)({backgroundColor:n.backgroundColors[a%n.backgroundColors.length]}),class:"mx-auto rounded-4 target-box"},[(0,s.Lk)("div",D,[(0,s.Lk)("div",E,[(0,s.Lk)("span",{class:(0,i.C4)([r.getStatusClass(t),"status-label"]),style:{"margin-left":"20px"}},(0,i.v_)(r.getStatusText(t)),3),(0,s.Lk)("div",B,(0,i.v_)(t.mile_name)+" 마일리지 ",1)]),(0,s.Lk)("div",S,[r.isUserParticipating(t.target_no)?((0,s.uX)(),(0,s.CE)("div",I,[(0,s.Lk)("div",{onClick:e=>r.handleClick(t.target_no),class:"participant-count"},[F,(0,s.Lk)("span",M,(0,i.v_)(t.participantCount),1)],8,A),r.isDropdownVisible(t.target_no)?((0,s.uX)(),(0,s.CE)("div",{key:0,class:"dropdown-menu",onClick:e[3]||(e[3]=(0,u.D$)((()=>{}),["stop"]))},[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(t.participants,(t=>((0,s.uX)(),(0,s.CE)("p",{key:t.user_no,style:{margin:"0",padding:"5px 0"}},(0,i.v_)(t.user_name),1)))),128))])):(0,s.Q3)("",!0)])):"진행중"===r.getStatusText(t)?((0,s.uX)(),(0,s.CE)("button",{key:1,onClick:e=>r.joinTarget(t.target_no),class:"join-button"}," 참여하기 > ",8,U)):"예정"===r.getStatusText(t)?((0,s.uX)(),(0,s.CE)("button",X," 참가하기 ")):"종료"===r.getStatusText(t)?((0,s.uX)(),(0,s.CE)("button",$," 미참여 ")):(0,s.Q3)("",!0)])]),(0,s.Lk)("div",j,[N,R,(0,s.Lk)("div",K,[(0,s.Lk)("div",V,[(0,s.Lk)("div",{class:"progress-bar progress-bar-striped progress-bar-animated",style:(0,i.Tr)({width:r.getAchievementRate(t),backgroundColor:"#FB773C"})},null,4)]),(0,s.Lk)("span",z,(0,i.v_)(r.getAchievementRate(t)),1)]),(0,s.Lk)("span",O,(0,i.v_)(t.start_date)+" - "+(0,i.v_)(t.end_date),1)]),H,(0,s.Lk)("div",Q,[(0,s.Lk)("span",W,[(0,s.Lk)("span",q,(0,i.v_)(r.getScore(t)),1),(0,s.eW)(" / "+(0,i.v_)(t.target_mileage),1)])])],4)])])))),128))]))])}var Y=a(66278),G=a(37682),Z={name:"TogetherTarget",data(){return{mileages:[],backgroundColors:["#F5F5F5"],sortBy:"notjoin",isUserParticipated:{},userParticipatedTargets:JSON.parse(localStorage.getItem("userParticipatedTargets")||"[]"),isLoading:!0,dropDownVisible:{}}},methods:{...(0,Y.i0)("target",["fetchAdminTargets","joinTarget","checkParticipation"]),loginInfo(){return this.getLoginInfo},isChecked(){return this.getIsChecked},isLoggedIn(){return!!this.loginInfo},async fetchMileages(){try{const t=await G.A.get("/notice/mileage");this.mileages=t.data}catch(t){console.error("Error fetching mileages:",t.response?t.response.data:t.message)}},getStatusClass(t){const e=new Date,a=new Date(t.start_date),s=new Date(t.end_date);return e<a?"upcoming":e>s?"completed":"ongoing"},getAchievementRate(t){return this.isUserParticipating(t.target_no)?`${Math.min(t.achievementRate,100)}%`:"0%"},getScore(t){return this.isUserParticipating(t.target_no)&&t.totalMileScoreByTargetNo||0},calculateProgress(t){if(!t||void 0===t.achievementRate||void 0===t.target_mileage)return"0%";if(!t||void 0===t.achievementRate||void 0===t.target_mileage)return"0%";const e=t.totalMileScoreByMileNo/t.target_mileage*100;return isNaN(e)?"0%":`${e.toFixed(2)}%`},getStatusText(t){if(!t||!t.start_date||!t.end_date)return"알 수 없음";const e=new Date,a=new Date(t.start_date),s=new Date(t.end_date);return e<a?"예정":e>s?"종료":"진행중"},sortTargets(t){return t.sort(((t,e)=>{if(t.mile_no!==e.mile_no)return t.mile_no-e.mile_no;const a=this.getStatusText(t),s=this.getStatusText(e),i=this.isUserParticipating(t.target_no),o=this.isUserParticipating(e.target_no);return i&&!o?-1:!i&&o?1:"진행중"===a&&"진행중"!==s?-1:"진행중"!==a&&"진행중"===s?1:"예정"===a&&"예정"!==s?-1:"예정"!==a&&"예정"===s||"종료"===a&&"종료"!==s?1:"종료"!==a&&"종료"===s?-1:0}))},filteredTargets(t){return this.adminTargets.filter((e=>{const a=this.getStatusText(e),s=this.isUserParticipating(e.target_no);return"finished"===t?"종료"===a:"not-finished"===t?s&&"종료"!==a:"notjoin"!==t||(!s&&"진행중"===a||"예정"===a)}))},sortedAdminTargets(t){return t.sort(((t,e)=>t.mile_no-e.mile_no))},async checkParticipation(t){try{const e=await this.$store.dispatch("target/checkParticipation",{targetNo:t,userNo:this.loginInfo.user_no});if("boolean"===typeof e)return this.isUserParticipated[t]=e,e;throw new Error("Invalid response format")}catch(e){return console.error("Failed to check user participation:",e),!1}},async loadUserParticipatedTargets(){try{const t=this.adminTargets.map((t=>t.target_no));console.log("5. Target numbers:",t);const e=t.map((t=>this.checkParticipation(t).then((e=>{e&&this.userParticipatedTargets.push(t)}))));await Promise.all(e),console.log("7. Updated userParticipatedTargets:",this.userParticipatedTargets)}catch(t){console.error("Failed to load user participated targets:",t)}finally{this.isLoading=!1}},async joinTarget(t){try{const e=await this.$store.dispatch("target/joinTarget",{targetNo:t,userNo:this.loginInfo.user_no});if(e.success){this.userParticipatedTargets.push(t),localStorage.setItem("userParticipatedTargets",JSON.stringify(this.userParticipatedTargets));const e=this.adminTargets.find((e=>e.target_no===t));e&&(e.participantCount=(e.participantCount||0)+1)}}catch(e){console.error("Failed to join target:",e)}},initializeUserParticipation(){this.adminTargets.forEach((t=>{this.isUserParticipated[t.target_no]=this.userParticipatedTargets.includes(t.target_no)}))},handleClick(t){console.log("Clicked:",t),this.toggleDropdown(t)},toggleDropdown(t){console.log("Clicked:",t),this.dropDownVisible[t]=!this.dropDownVisible[t]},isDropdownVisible(t){return!!this.dropDownVisible[t]},closeAllDropdowns(t){t.target.closest(".participation-info")||(this.dropDownVisible={})},isUserParticipating(t){return this.userParticipatedTargets.includes(t)},isParticipating(t){return t.participants&&t.participants.length>0},applyFadeUpEffect(){const t=document.querySelectorAll(".fade-up-item");t.forEach(((t,e)=>{const a=50*e;setTimeout((()=>{t.classList.add("fade-up-active")}),a)}))}},async created(){console.log("1. Component created"),this.isLoading=!0;try{await this.fetchMileages(),await this.fetchAdminTargets(this.loginInfo.user_no),await this.loadUserParticipatedTargets()}catch(t){console.error("Error initializing component:",t)}finally{this.isLoading=!1}},mounted(){document.addEventListener("click",this.closeAllDropdowns)},beforeUnmount(){document.removeEventListener("click",this.closeAllDropdowns)},computed:{...(0,Y.L8)("login",["getLoginInfo","getIsChecked"]),...(0,Y.aH)("login",["loginInfo"]),...(0,Y.L8)("target",["getAdminTargets"]),adminTargets(){return this.getAdminTargets},displayedTargets(){const t=this.filteredTargets(this.sortBy);return this.sortTargets(t)},totalTargetsCount(){return this.adminTargets.length}},watch:{getLoginInfo:{immediate:!0,handler(t){t&&t.user_no?(console.log("Calling getAdminTargets with user_no:",t.user_no),this.fetchAdminTargets(t.user_no).then((()=>{this.isLoading=!1,this.$nextTick((()=>{this.applyFadeUpEffect()}))}))):this.dataLoaded=!1}},sortBy(){this.$nextTick((()=>{this.applyFadeUpEffect()}))},displayedTargets:{handler(t){t.forEach((t=>{this.isLoggedIn()&&100===Math.min(t.achievementRate,100)&&"종료"!==this.getStatusText(t)&&this.$store.dispatch("/target/increaseMawangScore",{targetNo:t.target_no,userNo:this.loginInfo.user_no})}))},deep:!0}}},tt=a(66262);const et=(0,tt.A)(Z,[["render",J],["__scopeId","data-v-1f18016a"]]);var at=et;const st=t=>((0,s.Qi)("data-v-773a7e9e"),t=t(),(0,s.jt)(),t),it={class:"d-flex justify-content-start align-items-center mb-5",style:{"margin-left":"5%"}},ot={style:{display:"flex","align-items":"center"}},nt={class:"count"},rt={class:"radio-container p-3 lg2"},lt=st((()=>(0,s.Lk)("label",{class:"radio-label",for:"finished"},[(0,s.Lk)("span",{class:"custom-radio"}),(0,s.eW)(" 종료 ")],-1))),dt={class:"radio-container p-3 lg2"},ct=st((()=>(0,s.Lk)("label",{class:"radio-label",for:"notFinished"},[(0,s.Lk)("span",{class:"custom-radio"}),(0,s.eW)(" 진행중 ")],-1))),gt={key:0,class:"text-center mb-4",style:{color:"gray"}},pt={class:"row"},ut={class:"p-3"},ht={class:"py-1",style:{display:"flex","align-items":"center","margin-bottom":"-10px",position:"relative"}},mt={style:{"text-align":"left","margin-left":"10px","margin-top":"10px","font-weight":"bold","font-family":"KB_C2","font-size":"13pt"},class:"mb-2"},ft={class:"button-container"},yt=["onClick"],kt={class:"py-3"},vt={class:"py-3",style:{display:"flex","flex-direction":"column","align-items":"flex-start","margin-left":"20px"}},bt=st((()=>(0,s.Lk)("span",{class:"lg2",style:{"font-family":"'KB_C1'","font-size":"20px","margin-bottom":"-25px"}},"개인 진행률",-1))),Lt=st((()=>(0,s.Lk)("br",null,null,-1))),Tt={style:{display:"flex","justify-content":"space-between","align-items":"center",width:"100%"}},_t={class:"progress",role:"progressbar","aria-label":"Animated striped example","aria-valuenow":"60","aria-valuemin":"0","aria-valuemax":"100",style:{width:"80%","margin-right":"10px"}},wt={style:{"font-weight":"bold","white-space":"nowrap","font-family":"'KB_C2'","font-size":"25px","margin-right":"10px"}},xt={class:"md",style:{"margin-top":"5px","font-size":"13px","font-family":"'KB_C2'"}},Ct=st((()=>(0,s.Lk)("span",{class:"lg2",style:{"font-family":"'KB_C1'","font-size":"17px"}}," 🎯 나의 마일리지 / 목표 마일리지 ",-1))),Pt={class:"py-3"},Dt={class:"bold-x-lg",style:{"font-family":"'KB_C1'"}},Et={class:"highlight-score"},Bt={class:"d-flex justify-content-center",style:{"margin-top":"12vh"}},St={key:0,class:"modal-overlay"},It={class:"modal-content"},At={class:"modal-header"},Ft=st((()=>(0,s.Lk)("h2",{class:"modal-title"},"개인별 목표 설정하기",-1))),Mt={class:"modal-body"},Ut={class:"form-group"},Xt=st((()=>(0,s.Lk)("label",{for:"mileage-select"},"목표 마일리지",-1))),$t={class:"select-wrapper"},jt=["value"],Nt=st((()=>(0,s.Lk)("i",{class:"bi bi-caret-down-fill select-icon"},null,-1))),Rt={class:"form-group"},Kt=st((()=>(0,s.Lk)("label",null,"목표 기간",-1))),Vt={class:"date-range"},zt=st((()=>(0,s.Lk)("span",{class:"date-separator"},"~",-1))),Ot={class:"form-group"},Ht=st((()=>(0,s.Lk)("label",{for:"mileage-score"},"목표 마일리지 점수",-1))),Qt={class:"modal-footer"};function Wt(t,e,a,o,n,r){const l=(0,s.g2)("Datepicker");return(0,s.uX)(),(0,s.CE)("div",null,[(0,s.Lk)("div",it,[(0,s.Lk)("div",ot,[(0,s.Lk)("span",nt," 총 "+(0,i.v_)(r.totalTargetsCount)+"건 ",1)]),(0,s.Lk)("div",rt,[(0,s.bo)((0,s.Lk)("input",{class:"radio-input",type:"radio",name:"targetList",id:"finished",value:"finished","onUpdate:modelValue":e[0]||(e[0]=t=>n.sortBy=t)},null,512),[[u.XL,n.sortBy]]),lt]),(0,s.Lk)("div",dt,[(0,s.bo)((0,s.Lk)("input",{class:"radio-input",type:"radio",name:"targetList",id:"notFinished",value:"not-finished","onUpdate:modelValue":e[1]||(e[1]=t=>n.sortBy=t)},null,512),[[u.XL,n.sortBy]]),ct])]),0===r.filteredMileages.length?((0,s.uX)(),(0,s.CE)("div",gt," 진행 중인 목표가 없습니다. ")):(0,s.Q3)("",!0),(0,s.Lk)("div",pt,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(r.filteredMileages,((t,e)=>((0,s.uX)(),(0,s.CE)("div",{key:t.target_no,ref_for:!0,ref:"fadeUpItems",class:"col-md-4 mb-3 fade-up-item"},[(0,s.Lk)("div",ut,[(0,s.Lk)("div",{style:(0,i.Tr)({backgroundColor:n.backgroundColors[e%n.backgroundColors.length]}),class:"mx-auto rounded-4 target-box"},[(0,s.Lk)("div",ht,[(0,s.Lk)("span",{class:(0,i.C4)([r.getStatusClass(t),"status-label"]),style:{"margin-left":"20px"}},(0,i.v_)(r.getStatusText(t)),3),(0,s.Lk)("div",mt,(0,i.v_)(t.mile_name)+" 마일리지 ",1),(0,s.Lk)("div",ft,[(0,s.Lk)("button",{class:"delete-button",onClick:e=>r.deleteTarget(t.target_no)}," 삭제 ",8,yt)])]),(0,s.Lk)("div",kt,[(0,s.Lk)("div",vt,[bt,Lt,(0,s.Lk)("div",Tt,[(0,s.Lk)("div",_t,[(0,s.Lk)("div",{class:"progress-bar progress-bar-striped progress-bar-animated",style:(0,i.Tr)({width:`${r.getAchievementRate(t)}%`,backgroundColor:"#FB773C"})},null,4)]),(0,s.Lk)("span",wt,(0,i.v_)(r.getAchievementRate(t))+" %",1)]),(0,s.Lk)("span",xt,(0,i.v_)(t.start_date)+" - "+(0,i.v_)(t.end_date),1)]),Ct,(0,s.Lk)("div",Pt,[(0,s.Lk)("span",Dt,[(0,s.Lk)("span",Et,(0,i.v_)(r.getMileageScore(t)),1),(0,s.eW)(" / "+(0,i.v_)(t.target_mileage),1)])])])],4)])])))),128)),(0,s.Lk)("div",Bt,[(0,s.Lk)("button",{class:"addbtn",onClick:e[2]||(e[2]=(...t)=>r.openModal&&r.openModal(...t))},"목표 추가")]),n.isModalOpen?((0,s.uX)(),(0,s.CE)("div",St,[(0,s.Lk)("div",It,[(0,s.Lk)("div",At,[Ft,(0,s.Lk)("button",{class:"close-button",onClick:e[3]||(e[3]=(...t)=>r.closeModal&&r.closeModal(...t))},"×")]),(0,s.Lk)("div",Mt,[(0,s.Lk)("div",Ut,[Xt,(0,s.Lk)("div",$t,[(0,s.bo)((0,s.Lk)("select",{"onUpdate:modelValue":e[4]||(e[4]=t=>n.selectedLabel=t),id:"mileage-select",class:"form-select"},[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(n.labels,(t=>((0,s.uX)(),(0,s.CE)("option",{key:t,value:t},(0,i.v_)(t.mile_name),9,jt)))),128))],512),[[u.u1,n.selectedLabel]]),Nt])]),(0,s.Lk)("div",Rt,[Kt,(0,s.Lk)("div",Vt,[(0,s.bF)(l,{modelValue:n.startDate,"onUpdate:modelValue":e[5]||(e[5]=t=>n.startDate=t),format:r.formatDate,"min-date":new Date,placeholder:"시작일"},null,8,["modelValue","format","min-date"]),zt,(0,s.bF)(l,{modelValue:n.endDate,"onUpdate:modelValue":e[6]||(e[6]=t=>n.endDate=t),format:r.formatDate,"min-date":n.startDate||new Date,placeholder:"종료일"},null,8,["modelValue","format","min-date"])])]),(0,s.Lk)("div",Ot,[Ht,(0,s.bo)((0,s.Lk)("input",{type:"number",id:"mileage-score","onUpdate:modelValue":e[7]||(e[7]=t=>n.targetScore=t)},null,512),[[u.Jo,n.targetScore]])])]),(0,s.Lk)("div",Qt,[(0,s.Lk)("button",{class:"submit-button",onClick:e[8]||(e[8]=(...t)=>r.addAction&&r.addAction(...t))},"등록")])])])):(0,s.Q3)("",!0)])])}var qt=a(66652),Jt=a(78465),Yt=a.n(Jt),Gt={name:"PersonalTarget",emits:["dataLoaded"],components:{Datepicker:qt.A},data(){return{mileages:[],isModalOpen:!1,labels:[],selectedLabel:null,startDate:null,endDate:null,targetScore:0,backgroundColors:["#F5F5F5"],sortBy:"not-finished"}},methods:{...(0,Y.i0)("target",["addPersonalTarget","fetchPersonalTargets","deleteTarget"]),loginInfo(){return this.getLoginInfo},isChecked(){return this.getIsChecked},isLoggedIn(){return!!this.loginInfo},async fetchMileages(){try{const t=await G.A.get("/notice/mileage");this.labels=t.data}catch(t){console.error("Error fetching mileages:",t.response?t.response.data:t.message)}},handleCheckboxChange(t){"finished"===t&&this.sortByFin?this.sortByNotFin=!1:"not-finished"===t&&this.sortByNotFin&&(this.sortByFin=!1)},formatDate(t){const e=t.getFullYear(),a=String(t.getMonth()+1).padStart(2,"0"),s=String(t.getDate()).padStart(2,"0");return`${e}-${a}-${s}`},openModal(){this.isModalOpen=!0},closeModal(){this.isModalOpen=!1},async addAction(){const t={mile_no:this.selectedLabel.mile_no,user_no:this.loginInfo.user_no,start_date:this.startDate,end_date:this.endDate,target_mileage:this.targetScore,is_together:!1,is_manager_plan:!1,month:(new Date).getMonth()+1,achievementRate:0};try{await this.addPersonalTarget(t),this.closeModal(),window.location.reload()}catch(e){console.error("Error adding target:",e.response?e.response.data:e.message)}},calculateProgress(t){if(!t||void 0===t.achievementRate||void 0===t.target_mileage)return"0%";if("예정"===this.getStatusText(t))return"0%";const e=t.totalMileScoreByMileNo/t.target_mileage*100;return isNaN(e)?"0%":`${e.toFixed(2)}%`},getStatusClass(t){const e=new Date,a=new Date(t.start_date),s=new Date(t.end_date);return e<a?"upcoming":e>s?"completed":"ongoing"},getStatusText(t){if(!t||!t.start_date||!t.end_date)return"알 수 없음";const e=new Date,a=new Date(t.start_date),s=new Date(t.end_date);return e>s?"종료":e<a?"예정":"진행중"},getMileageScore(t){return"예정"===this.getStatusText(t)?0:t.totalMileScoreByTargetNo||0},getAchievementRate(t){return"예정"===this.getStatusText(t)?0:Math.min(t.achievementRate,100)},sortTargets(t){return t.sort(((t,e)=>{const a=this.getStatusText(t),s=this.getStatusText(e);return"진행중"===a&&"진행중"!==s?-1:"진행중"!==a&&"진행중"===s?1:"예정"===a&&"예정"!==s?-1:"예정"!==a&&"예정"===s?1:0}))},filteredTargets(t){const e=new Date;return this.adminTargets.filter((a=>{const s=new Date(a.end_date);return"finished"===t?e>s:e<=s}))},sortedAdminTargets(t){return t.sort(((t,e)=>t.mile_no-e.mile_no))},async loadUserParticipatedTargets(){try{const t=this.adminTargets.map((t=>t.target_no));for(const e of t){const t=await this.checkParticipation(e);t&&this.userParticipatedTargets.push(e)}}catch(t){console.error("Failed to load user participated targets:",t)}finally{this.isLoading=!1}},async deleteTarget(t){Yt().fire({title:"경고",text:"정말로 삭제하시겠습니까?",icon:"warning",reverseButtons:!1,willOpen:()=>{document.body.style.paddingRight="0px"},willClose:()=>{document.body.style.paddingRight="0px"}}).then((async e=>{if(e.isConfirmed)try{const e=this.$store.getters["login/getLoginInfo"].user_no;await this.$store.dispatch("target/deleteTarget",{userNo:e,targetNo:t}),Yt().fire({title:"삭제 완료",text:"삭제가 완료되었습니다.",icon:"success",scrollbarPadding:!1,willOpen:()=>{document.body.style.paddingRight="0px"},willClose:()=>{document.body.style.paddingRight="0px"}}).then((()=>{window.location.reload()}))}catch(a){Yt().fire({title:"오류 발생",text:"삭제 중 오류가 발생했습니다. 다시 시도해 주세요.",icon:"error",scrollbarPadding:!1,willOpen:()=>{document.body.style.paddingRight="0px"},willClose:()=>{document.body.style.paddingRight="0px"}})}else Yt().fire({title:"취소됨",text:"삭제가 취소되었습니다.",icon:"info",scrollbarPadding:!1,willOpen:()=>{document.body.style.paddingRight="0px"},willClose:()=>{document.body.style.paddingRight="0px"}})}))},showAlert(t,e){this.$swal({title:t,icon:e,confirmButtonText:"확인",confirmButtonColor:"#4b4a4a",allowOutsideClick:!1,allowEscapeKey:!1,allowEnterKey:!1,stopKeydownPropagation:!1,scrollbarPadding:!1,backdrop:!0,didOpen:()=>{document.body.classList.add("no-scroll"),document.documentElement.style.overflow="hidden"},willClose:()=>{document.body.classList.remove("no-scroll"),document.documentElement.style.overflow=""}})},applyFadeUpEffect(){const t=this.$refs.fadeUpItems;t&&0!==t.length&&t.forEach(((e,a)=>{e.style.setProperty("--index",a),e.style.setProperty("z-index",t.length-a);const s=50,i=s+50*a;setTimeout((()=>{e.classList.add("fade-up-active")}),i)}))}},async created(){this.isLoading=!0;try{await this.fetchMileages(),await this.fetchPersonalTargets(this.loginInfo.user_no)}catch(t){console.error("Error initializing component:",t)}finally{this.isLoading=!1}},computed:{...(0,Y.L8)("login",["getLoginInfo","getIsChecked"]),...(0,Y.aH)("login",["loginInfo"]),...(0,Y.L8)("target",["getPersonalTargets"]),adminTargets(){return Array.isArray(this.getPersonalTargets)?this.getPersonalTargets:[]},displayedTargets(){const t=this.filteredTargets(this.sortBy),e=this.sortedAdminTargets(t);return"not-finished"===this.sortBy?this.sortTargets(e):e},totalTargetsCount(){return this.displayedTargets.length},targets(){const t=this.getPersonalTargets;return Array.isArray(t)?t:[]},filteredMileages(){const t=new Date,e=[...this.targets].sort(((t,e)=>t.mile_no-e.mile_no)).sort(((t,e)=>{const a=this.getStatusText(t),s=this.getStatusText(e);return"진행중"===a&&"진행중"!==s?-1:"진행중"!==a&&"진행중"===s?1:"예정"===a&&"예정"!==s?-1:"예정"!==a&&"예정"===s?1:0}));return e.filter((e=>{if(!e||!e.end_date)return!1;const a=new Date(e.end_date);return!isNaN(a.getTime())&&("finished"===this.sortBy?a<t:"not-finished"!==this.sortBy||a>=t)}))}},watch:{getLoginInfo:{immediate:!0,handler(t){t&&t.user_no?this.fetchPersonalTargets(t.user_no).then((()=>{this.isLoading=!1,this.$nextTick((()=>{this.applyFadeUpEffect()}))})):this.dataLoaded=!1}},sortBy(){this.$nextTick((()=>{this.applyFadeUpEffect()}))}}};const Zt=(0,tt.A)(Gt,[["render",Wt],["__scopeId","data-v-773a7e9e"]]);var te=Zt,ee={name:"MyMileageTarget",components:{TogetherTarget:at,PersonalTarget:te},data(){return{activeTab:"together",showHelpPopover:!1}},methods:{setActiveTab(t){this.activeTab=t,this.$router.push({query:{tab:t}})},toggleHelpPopover(t){t.stopPropagation(),this.showHelpPopover=!this.showHelpPopover,this.showHelpPopover?document.addEventListener("click",this.handleClickOutside):document.removeEventListener("click",this.handleClickOutside)},handleClickOutside(t){!this.$refs.helpPopover||this.$refs.helpPopover.contains(t.target)||this.$refs.helpIcon.contains(t.target)||(this.showHelpPopover=!1,document.removeEventListener("click",this.handleClickOutside))}},created(){},computed:{currentComponent(){switch(this.activeTab){case"together":return"TogetherTarget";case"personal":return"PersonalTarget";default:return"TogetherTarget"}}},watch:{"$route.query.tab":{immediate:!0,handler(t){t&&(this.activeTab=t)}}}};const ae=(0,tt.A)(ee,[["render",p],["__scopeId","data-v-bf6ffd8a"]]);var se=ae}}]);
//# sourceMappingURL=8997.2dba39cc.js.map