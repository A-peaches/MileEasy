"use strict";(self["webpackChunkmile"]=self["webpackChunkmile"]||[]).push([[7333],{7333:function(e,t,a){a.r(t),a.d(t,{default:function(){return tt}});var s=a(641),i=a(33);const o=e=>((0,s.Qi)("data-v-58cff39a"),e=e(),(0,s.jt)(),e),n={class:"cards page-back mx-auto"},r={class:"bold-x-lg mt-5 mb-4",style:{"font-family":"KB_C3"}},l={key:0,class:"help-popover",ref:"helpPopover"},d=o((()=>(0,s.Lk)("div",{style:{"font-size":"12pt"}},[(0,s.Lk)("span",null," 그룹 목표 100% 달성 시 마왕 점수가 상승하고, 개인 목표로 성장을 계획하세요. ")],-1))),c=[d],g={class:"input-base input-search d-flex justify-content-center mx-auto my-5",style:{width:"600px",background:"#ebebeb"}};function p(e,t,a,o,d,p){return(0,s.uX)(),(0,s.CE)("div",n,[(0,s.Lk)("h2",r,[(0,s.eW)(" 목표설정 "),(0,s.Lk)("i",{class:"bi bi-question-circle help-icon",onClick:t[0]||(t[0]=(...e)=>p.toggleHelpPopover&&p.toggleHelpPopover(...e)),style:{"font-size":"20pt"},ref:"helpIcon"},null,512)]),d.showHelpPopover?((0,s.uX)(),(0,s.CE)("div",l,c,512)):(0,s.Q3)("",!0),(0,s.Lk)("div",g,[(0,s.Lk)("button",{class:(0,i.C4)(["tab-container lg2 fw-bold",{active:"together"===d.activeTab}]),onClick:t[1]||(t[1]=e=>p.setActiveTab("together"))}," 참여형 ",2),(0,s.Lk)("button",{class:(0,i.C4)(["tab-container lg2 fw-bold",{active:"personal"===d.activeTab}]),onClick:t[2]||(t[2]=e=>p.setActiveTab("personal"))}," 개인형 ",2)]),((0,s.uX)(),(0,s.Wv)((0,s.$y)(p.currentComponent),{onDataLoaded:e.handleDataLoaded,class:"my-5"},null,40,["onDataLoaded"]))])}a(4114);var u=a(3751);const h=e=>((0,s.Qi)("data-v-619e3f08"),e=e(),(0,s.jt)(),e),m={class:"d-flex justify-content-start align-items-center mb-5",style:{"margin-left":"5%"}},f={style:{display:"flex","align-items":"center"}},y={class:"count"},k={class:"radio-container p-3 lg2"},v=h((()=>(0,s.Lk)("label",{class:"radio-label",for:"finished"},[(0,s.Lk)("span",{class:"custom-radio"}),(0,s.eW)(" 종료 ")],-1))),b={class:"radio-container p-3 lg2"},L=h((()=>(0,s.Lk)("label",{class:"radio-label",for:"notFinished"},[(0,s.Lk)("span",{class:"custom-radio"}),(0,s.eW)(" 참여 ")],-1))),T={class:"radio-container p-3 lg2"},w=h((()=>(0,s.Lk)("label",{class:"radio-label",for:"notjoin"},[(0,s.Lk)("span",{class:"custom-radio"}),(0,s.eW)(" 미참여 ")],-1))),_={key:0,class:"row"},x={class:"p-3"},C={class:"py-3",style:{display:"flex","align-items":"center","justify-content":"space-between","margin-bottom":"-10px"}},P={style:{display:"flex","align-items":"center",flex:"1"}},D={style:{"text-align":"left","margin-left":"10px","margin-top":"10px","font-weight":"bold","font-family":"KB_C2","font-size":"13pt"},class:"mb-2"},B={style:{display:"flex","align-items":"center","justify-content":"flex-end",width:"100px",position:"relative",overflow:"hidden"}},E={key:0,class:"participation-info"},I=["onClick"],S=h((()=>(0,s.Lk)("i",{class:"bi bi-person-vcard",style:{"margin-right":"12px","margin-bottom":"2px","font-size":"25px",color:"#8c8c8c"}},null,-1))),A={style:{"margin-right":"25px"}},F=["onClick","disabled"],M={class:"py-3",style:{display:"flex","flex-direction":"column","align-items":"flex-start","margin-left":"20px"}},U=h((()=>(0,s.Lk)("span",{class:"lg2",style:{"font-family":"'KB_C1'","font-size":"20px","margin-bottom":"-25px"}},"그룹 달성률",-1))),$=h((()=>(0,s.Lk)("br",null,null,-1))),X={style:{display:"flex","justify-content":"space-between","align-items":"center",width:"100%"}},j={class:"progress",role:"progressbar","aria-label":"Animated striped example","aria-valuenow":"60","aria-valuemin":"0","aria-valuemax":"100",style:{width:"80%","margin-right":"10px"}},K={style:{"font-weight":"bold","white-space":"nowrap","font-family":"'KB_C2'","font-size":"25px","margin-right":"10px"}},V={class:"md",style:{"margin-top":"5px","font-size":"13px","font-family":"'KB_C2'"}},z=h((()=>(0,s.Lk)("span",{class:"lg2",style:{"font-family":"'KB_C1'","font-size":"17px"}}," 🎯 나의 마일리지 / 목표 마일리지 ",-1))),N={class:"py-3"},O={class:"bold-x-lg",style:{"font-family":"'KB_C1'"}},R={class:"highlight-score"},H={key:1,style:{"font-size":"20px"}},W=h((()=>(0,s.Lk)("i",{class:"bi bi-arrow-clockwise"},null,-1)));function Q(e,t,a,o,n,r){return(0,s.uX)(),(0,s.CE)("div",null,[(0,s.Lk)("div",m,[(0,s.Lk)("div",f,[(0,s.Lk)("span",y," 총 "+(0,i.v_)(r.totalTargetsCount)+"건 ",1)]),(0,s.Lk)("div",k,[(0,s.bo)((0,s.Lk)("input",{class:"radio-input",type:"radio",name:"targetList",id:"finished",value:"finished","onUpdate:modelValue":t[0]||(t[0]=e=>n.sortBy=e)},null,512),[[u.XL,n.sortBy]]),v]),(0,s.Lk)("div",b,[(0,s.bo)((0,s.Lk)("input",{class:"radio-input",type:"radio",name:"targetList",id:"notFinished",value:"not-finished","onUpdate:modelValue":t[1]||(t[1]=e=>n.sortBy=e)},null,512),[[u.XL,n.sortBy]]),L]),(0,s.Lk)("div",T,[(0,s.bo)((0,s.Lk)("input",{class:"radio-input",type:"radio",name:"targetList",id:"notjoin",value:"notjoin","onUpdate:modelValue":t[2]||(t[2]=e=>n.sortBy=e)},null,512),[[u.XL,n.sortBy]]),w])]),n.isLoading?((0,s.uX)(),(0,s.CE)("div",H,[W,(0,s.eW)(" 로딩 중... ")])):((0,s.uX)(),(0,s.CE)("div",_,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(r.displayedTargets,((e,a)=>((0,s.uX)(),(0,s.CE)("div",{key:e.target_no,class:"col-md-4 mb-3"},[(0,s.Lk)("div",x,[(0,s.Lk)("div",{style:(0,i.Tr)({backgroundColor:n.backgroundColors[a%n.backgroundColors.length]}),class:"mx-auto rounded-4 target-box"},[(0,s.Lk)("div",C,[(0,s.Lk)("div",P,[(0,s.Lk)("span",{class:(0,i.C4)([r.getStatusClass(e),"status-label"]),style:{"margin-left":"20px"}},(0,i.v_)(r.getStatusText(e)),3),(0,s.Lk)("div",D,(0,i.v_)(e.mile_name)+" 마일리지 ",1)]),(0,s.Lk)("div",B,[r.isUserParticipating(e.target_no)?((0,s.uX)(),(0,s.CE)("div",E,[(0,s.Lk)("div",{onClick:t=>r.handleClick(e.target_no),class:"participant-count"},[S,(0,s.Lk)("span",A,(0,i.v_)(e.participantCount),1)],8,I),r.isDropdownVisible(e.target_no)?((0,s.uX)(),(0,s.CE)("div",{key:0,class:"dropdown-menu",onClick:t[3]||(t[3]=(0,u.D$)((()=>{}),["stop"]))},[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(e.participants,(e=>((0,s.uX)(),(0,s.CE)("p",{key:e.user_no,style:{margin:"0",padding:"5px 0"}},(0,i.v_)(e.user_name),1)))),128))])):(0,s.Q3)("",!0)])):((0,s.uX)(),(0,s.CE)("button",{key:1,onClick:t=>r.joinTarget(e.target_no),class:"join-button",disabled:"진행중"!==r.getStatusText(e)}," 참여하기 > ",8,F))])]),(0,s.Lk)("div",M,[U,$,(0,s.Lk)("div",X,[(0,s.Lk)("div",j,[(0,s.Lk)("div",{class:"progress-bar progress-bar-striped progress-bar-animated",style:(0,i.Tr)({width:Math.min(e.achievementRate,100)+"%",backgroundColor:"#FB773C "})},null,4)]),(0,s.Lk)("span",K,(0,i.v_)(r.getDisplayableAchievementRate(e)),1)]),(0,s.Lk)("span",V,(0,i.v_)(e.start_date)+" - "+(0,i.v_)(e.end_date),1)]),z,(0,s.Lk)("div",N,[(0,s.Lk)("span",O,[(0,s.Lk)("span",R,(0,i.v_)(e.totalMileScoreByMileNo),1),(0,s.eW)(" / "+(0,i.v_)(e.target_mileage),1)])])],4)])])))),128))]))])}var q=a(6278),J=a(7682),Y={name:"TogetherTarget",data(){return{mileages:[],backgroundColors:["#F5F5F5"],sortBy:"notjoin",isUserParticipated:{},userParticipatedTargets:JSON.parse(localStorage.getItem("userParticipatedTargets")||"[]"),isLoading:!0,dropDownVisible:{}}},methods:{...(0,q.i0)("target",["fetchAdminTargets","joinTarget","checkParticipation"]),loginInfo(){return this.getLoginInfo},isChecked(){return this.getIsChecked},isLoggedIn(){return!!this.loginInfo},async fetchMileages(){try{const e=await J.A.get("/notice/mileage");this.mileages=e.data}catch(e){console.error("Error fetching mileages:",e.response?e.response.data:e.message)}},getStatusClass(e){const t=new Date,a=new Date(e.start_date),s=new Date(e.end_date);return t<a?"upcoming":t>s?"completed":"ongoing"},getDisplayableAchievementRate(e){this.getStatusText(e);return`${Math.min(e.achievementRate,100)}%`},getStatusText(e){const t=new Date,a=new Date(e.start_date),s=new Date(e.end_date);return t<a?"예정":t>s?"종료":"진행중"},sortTargets(e){return e.sort(((e,t)=>{if(e.mile_no!==t.mile_no)return e.mile_no-t.mile_no;const a=this.getStatusText(e),s=this.getStatusText(t),i=this.isUserParticipating(e.target_no),o=this.isUserParticipating(t.target_no);return i&&!o?-1:!i&&o?1:"진행중"===a&&"진행중"!==s?-1:"진행중"!==a&&"진행중"===s?1:"예정"===a&&"예정"!==s?-1:"예정"!==a&&"예정"===s||"종료"===a&&"종료"!==s?1:"종료"!==a&&"종료"===s?-1:0}))},filteredTargets(e){return this.adminTargets.filter((t=>{const a=this.getStatusText(t),s=this.isUserParticipating(t.target_no);return"finished"===e?"종료"===a:"not-finished"===e?s&&"종료"!==a:"notjoin"!==e||(!s&&"진행중"===a||"예정"===a)}))},sortedAdminTargets(e){return e.sort(((e,t)=>e.mile_no-t.mile_no))},async checkParticipation(e){try{const t=await this.$store.dispatch("target/checkParticipation",{targetNo:e,userNo:this.loginInfo.user_no});if("boolean"===typeof t)return console.log(`8. Checking participation for target ${e}:`,t),this.isUserParticipated[e]=t,t;throw new Error("Invalid response format")}catch(t){return console.error("Failed to check user participation:",t),!1}},async loadUserParticipatedTargets(){try{const e=this.adminTargets.map((e=>e.target_no));console.log("5. Target numbers:",e);const t=e.map((e=>this.checkParticipation(e).then((t=>{t&&this.userParticipatedTargets.push(e)}))));await Promise.all(t),console.log("7. Updated userParticipatedTargets:",this.userParticipatedTargets)}catch(e){console.error("Failed to load user participated targets:",e)}finally{this.isLoading=!1}},async joinTarget(e){try{const t=await this.$store.dispatch("target/joinTarget",{targetNo:e,userNo:this.loginInfo.user_no});if(t.success){this.userParticipatedTargets.push(e),localStorage.setItem("userParticipatedTargets",JSON.stringify(this.userParticipatedTargets));const t=this.adminTargets.find((t=>t.target_no===e));t&&(t.participantCount=(t.participantCount||0)+1)}}catch(t){console.error("Failed to join target:",t)}},initializeUserParticipation(){this.adminTargets.forEach((e=>{this.isUserParticipated[e.target_no]=this.userParticipatedTargets.includes(e.target_no)}))},handleClick(e){console.log("Clicked:",e),this.toggleDropdown(e)},toggleDropdown(e){console.log("Clicked:",e),this.dropDownVisible[e]=!this.dropDownVisible[e]},isDropdownVisible(e){return!!this.dropDownVisible[e]},closeAllDropdowns(e){e.target.closest(".participation-info")||(this.dropDownVisible={})},isUserParticipating(e){return this.userParticipatedTargets.includes(e)},isParticipating(e){return e.participants&&e.participants.length>0},applyFadeUpEffect(){console.log("Applying fade-up effect");const e=this.$el.querySelectorAll(".fade-up-item");console.log(`Found ${e.length} items to animate`),e.forEach(((t,a)=>{t.style.setProperty("--index",a),t.style.setProperty("z-index",e.length-a);const s=50,i=s+50*a;setTimeout((()=>{t.classList.add("fade-up-active")}),i)}))}},async created(){console.log("1. Component created"),this.isLoading=!0;try{await this.fetchMileages(),await this.fetchAdminTargets(this.loginInfo.user_no),await this.loadUserParticipatedTargets()}catch(e){console.error("Error initializing component:",e)}finally{this.isLoading=!1}},mounted(){document.addEventListener("click",this.closeAllDropdowns)},beforeUnmount(){document.removeEventListener("click",this.closeAllDropdowns)},computed:{...(0,q.L8)("login",["getLoginInfo","getIsChecked"]),...(0,q.aH)("login",["loginInfo"]),...(0,q.L8)("target",["getAdminTargets"]),adminTargets(){return this.getAdminTargets},displayedTargets(){const e=this.filteredTargets(this.sortBy);return this.sortTargets(e)},totalTargetsCount(){return this.adminTargets.length}},watch:{getLoginInfo:{immediate:!0,handler(e){e&&e.user_no?(console.log("Calling getAdminTargets with user_no:",e.user_no),this.fetchAdminTargets(e.user_no).then((()=>{this.isLoading=!1,this.$nextTick((()=>{this.applyFadeUpEffect()}))}))):this.dataLoaded=!1}},sortBy(){this.$nextTick((()=>{this.applyFadeUpEffect()}))},displayedTargets:{handler(e){e.forEach((e=>{100===Math.min(e.achievementRate,100)&&(console.log("마왕 서버로 갑니다.:",e.target_no),this.$store.dispatch("target/increaseMawangScore",{targetNo:e.target_no,userNo:this.loginInfo.user_no}))}))},deep:!0}}},G=a(6262);const Z=(0,G.A)(Y,[["render",Q],["__scopeId","data-v-619e3f08"]]);var ee=Z;const te=e=>((0,s.Qi)("data-v-79019f20"),e=e(),(0,s.jt)(),e),ae={class:"d-flex justify-content-start align-items-center mb-5",style:{"margin-left":"5%"}},se={style:{display:"flex","align-items":"center"}},ie={class:"count"},oe={class:"radio-container p-3 lg2"},ne=te((()=>(0,s.Lk)("label",{class:"radio-label",for:"finished"},[(0,s.Lk)("span",{class:"custom-radio"}),(0,s.eW)(" 종료 ")],-1))),re={class:"radio-container p-3 lg2"},le=te((()=>(0,s.Lk)("label",{class:"radio-label",for:"notFinished"},[(0,s.Lk)("span",{class:"custom-radio"}),(0,s.eW)(" 진행중 ")],-1))),de={key:0,class:"text-center mb-4",style:{color:"gray"}},ce={class:"row"},ge={class:"p-3"},pe={class:"py-1",style:{display:"flex","align-items":"center","margin-bottom":"-10px",position:"relative"}},ue={style:{"text-align":"left","margin-left":"10px","margin-top":"10px","font-weight":"bold","font-family":"KB_C2","font-size":"13pt"},class:"mb-2"},he={class:"button-container"},me=["onClick"],fe={class:"py-3"},ye={class:"py-3",style:{display:"flex","flex-direction":"column","align-items":"flex-start","margin-left":"20px"}},ke=te((()=>(0,s.Lk)("span",{class:"lg2",style:{"font-family":"'KB_C1'","font-size":"20px","margin-bottom":"-25px"}},"개인 진행률",-1))),ve=te((()=>(0,s.Lk)("br",null,null,-1))),be={style:{display:"flex","justify-content":"space-between","align-items":"center",width:"100%"}},Le={class:"progress",role:"progressbar","aria-label":"Animated striped example","aria-valuenow":"60","aria-valuemin":"0","aria-valuemax":"100",style:{width:"80%","margin-right":"10px"}},Te={style:{"font-weight":"bold","white-space":"nowrap","font-family":"'KB_C2'","font-size":"25px","margin-right":"10px"}},we={class:"md",style:{"margin-top":"5px","font-size":"13px","font-family":"'KB_C2'"}},_e=te((()=>(0,s.Lk)("span",{class:"lg2",style:{"font-family":"'KB_C1'","font-size":"17px"}}," 🎯 나의 마일리지 / 목표 마일리지 ",-1))),xe={class:"py-3"},Ce={class:"bold-x-lg",style:{"font-family":"'KB_C1'"}},Pe={class:"highlight-score"},De={class:"d-flex justify-content-center",style:{"margin-top":"12vh"}},Be={key:0,class:"modal-overlay"},Ee={class:"modal-content"},Ie={class:"modal-header"},Se=te((()=>(0,s.Lk)("h2",{class:"modal-title"},"개인별 목표 설정하기",-1))),Ae={class:"modal-body"},Fe={class:"form-group"},Me=te((()=>(0,s.Lk)("label",{for:"mileage-select"},"목표 마일리지",-1))),Ue={class:"select-wrapper"},$e=["value"],Xe=te((()=>(0,s.Lk)("i",{class:"bi bi-caret-down-fill select-icon"},null,-1))),je={class:"form-group"},Ke=te((()=>(0,s.Lk)("label",null,"목표 기간",-1))),Ve={class:"date-range"},ze=te((()=>(0,s.Lk)("span",{class:"date-separator"},"~",-1))),Ne={class:"form-group"},Oe=te((()=>(0,s.Lk)("label",{for:"mileage-score"},"목표 마일리지 점수",-1))),Re={class:"modal-footer"};function He(e,t,a,o,n,r){const l=(0,s.g2)("Datepicker");return(0,s.uX)(),(0,s.CE)("div",null,[(0,s.Lk)("div",ae,[(0,s.Lk)("div",se,[(0,s.Lk)("span",ie," 총 "+(0,i.v_)(r.totalTargetsCount)+"건 ",1)]),(0,s.Lk)("div",oe,[(0,s.bo)((0,s.Lk)("input",{class:"radio-input",type:"radio",name:"targetList",id:"finished",value:"finished","onUpdate:modelValue":t[0]||(t[0]=e=>n.sortBy=e)},null,512),[[u.XL,n.sortBy]]),ne]),(0,s.Lk)("div",re,[(0,s.bo)((0,s.Lk)("input",{class:"radio-input",type:"radio",name:"targetList",id:"notFinished",value:"not-finished","onUpdate:modelValue":t[1]||(t[1]=e=>n.sortBy=e)},null,512),[[u.XL,n.sortBy]]),le])]),0===r.filteredMileages.length?((0,s.uX)(),(0,s.CE)("div",de," 진행 중인 목표가 없습니다. ")):(0,s.Q3)("",!0),(0,s.Lk)("div",ce,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(r.filteredMileages,((e,t)=>((0,s.uX)(),(0,s.CE)("div",{key:e.target_no,class:"col-md-4 mb-3 fade-up-item"},[(0,s.Lk)("div",ge,[(0,s.Lk)("div",{style:(0,i.Tr)({backgroundColor:n.backgroundColors[t%n.backgroundColors.length]}),class:"mx-auto rounded-4 target-box"},[(0,s.Lk)("div",pe,[(0,s.Lk)("span",{class:(0,i.C4)([r.getStatusClass(e),"status-label"]),style:{"margin-left":"20px"}},(0,i.v_)(r.getStatusText(e)),3),(0,s.Lk)("div",ue,(0,i.v_)(e.mile_name)+" 마일리지 ",1),(0,s.Lk)("div",he,[(0,s.Lk)("button",{class:"delete-button",onClick:t=>r.deleteTarget(e.target_no)}," 삭제 ",8,me)])]),(0,s.Lk)("div",fe,[(0,s.Lk)("div",ye,[ke,ve,(0,s.Lk)("div",be,[(0,s.Lk)("div",Le,[(0,s.Lk)("div",{class:"progress-bar progress-bar-striped progress-bar-animated",style:(0,i.Tr)({width:r.calculateProgress(e),backgroundColor:"#FB773C"})},null,4)]),(0,s.Lk)("span",Te,(0,i.v_)(r.calculateProgress(e)),1)]),(0,s.Lk)("span",we,(0,i.v_)(e.start_date)+" - "+(0,i.v_)(e.end_date),1)]),_e,(0,s.Lk)("div",xe,[(0,s.Lk)("span",Ce,[(0,s.Lk)("span",Pe,(0,i.v_)(e.totalMileScoreByMileNo),1),(0,s.eW)(" / "+(0,i.v_)(e.target_mileage),1)])])])],4)])])))),128)),(0,s.Lk)("div",De,[(0,s.Lk)("button",{class:"addbtn",onClick:t[2]||(t[2]=(...e)=>r.openModal&&r.openModal(...e))},"목표 추가")]),n.isModalOpen?((0,s.uX)(),(0,s.CE)("div",Be,[(0,s.Lk)("div",Ee,[(0,s.Lk)("div",Ie,[Se,(0,s.Lk)("button",{class:"close-button",onClick:t[3]||(t[3]=(...e)=>r.closeModal&&r.closeModal(...e))},"×")]),(0,s.Lk)("div",Ae,[(0,s.Lk)("div",Fe,[Me,(0,s.Lk)("div",Ue,[(0,s.bo)((0,s.Lk)("select",{"onUpdate:modelValue":t[4]||(t[4]=e=>n.selectedLabel=e),id:"mileage-select",class:"form-select"},[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(n.labels,(e=>((0,s.uX)(),(0,s.CE)("option",{key:e,value:e},(0,i.v_)(e.mile_name),9,$e)))),128))],512),[[u.u1,n.selectedLabel]]),Xe])]),(0,s.Lk)("div",je,[Ke,(0,s.Lk)("div",Ve,[(0,s.bF)(l,{modelValue:n.startDate,"onUpdate:modelValue":t[5]||(t[5]=e=>n.startDate=e),format:r.formatDate,placeholder:"시작일"},null,8,["modelValue","format"]),ze,(0,s.bF)(l,{modelValue:n.endDate,"onUpdate:modelValue":t[6]||(t[6]=e=>n.endDate=e),format:r.formatDate,placeholder:"종료일"},null,8,["modelValue","format"])])]),(0,s.Lk)("div",Ne,[Oe,(0,s.bo)((0,s.Lk)("input",{type:"number",id:"mileage-score","onUpdate:modelValue":t[7]||(t[7]=e=>n.targetScore=e)},null,512),[[u.Jo,n.targetScore]])])]),(0,s.Lk)("div",Re,[(0,s.Lk)("button",{class:"submit-button",onClick:t[8]||(t[8]=(...e)=>r.addAction&&r.addAction(...e))},"등록")])])])):(0,s.Q3)("",!0)])])}var We=a(6652),Qe=a(8465),qe=a.n(Qe),Je={name:"PersonalTarget",emits:["dataLoaded"],components:{Datepicker:We.A},data(){return{mileages:[],isModalOpen:!1,labels:[],selectedLabel:null,startDate:null,endDate:null,targetScore:0,backgroundColors:["#F5F5F5"],sortBy:"not-finished"}},methods:{...(0,q.i0)("target",["addPersonalTarget","fetchPersonalTargets","deleteTarget"]),loginInfo(){return this.getLoginInfo},isChecked(){return this.getIsChecked},isLoggedIn(){return!!this.loginInfo},async fetchMileages(){try{const e=await J.A.get("/notice/mileage");console.log("fetchMileages 메소드 :",e.data),this.labels=e.data}catch(e){console.error("Error fetching mileages:",e.response?e.response.data:e.message)}},handleCheckboxChange(e){"finished"===e&&this.sortByFin?this.sortByNotFin=!1:"not-finished"===e&&this.sortByNotFin&&(this.sortByFin=!1)},formatDate(e){const t=e.getFullYear(),a=String(e.getMonth()+1).padStart(2,"0"),s=String(e.getDate()).padStart(2,"0");return`${t}-${a}-${s}`},openModal(){this.isModalOpen=!0},closeModal(){this.isModalOpen=!1},async addAction(){const e={mile_no:this.selectedLabel.mile_no,user_no:this.loginInfo.user_no,start_date:this.startDate,end_date:this.endDate,target_mileage:this.targetScore,is_together:!1,is_manager_plan:!1,month:(new Date).getMonth()+1,achievementRate:0};console.log("target이 서버로 데이터 넘기는 것 :",e);try{await this.addPersonalTarget(e),this.closeModal(),window.location.reload()}catch(t){console.error("Error adding target:",t.response?t.response.data:t.message)}},calculateProgress(e){if("종료"===this.getStatusText(e))return e.achievementRate+"%";if(!e.target_mileage||0===e.target_mileage)return"0%";const t=e.totalMileScoreByMileNo/e.target_mileage*100;return e.achievementRate=t>100?100:Math.round(t),e.achievementRate+"%"},getStatusClass(e){const t=new Date,a=new Date(e.start_date),s=new Date(e.end_date);return t<a?"upcoming":t>s?"completed":"ongoing"},getStatusText(e){const t=new Date,a=new Date(e.start_date),s=new Date(e.end_date);return t>s?"종료":t<a?"예정":"진행중"},sortTargets(e){return e.sort(((e,t)=>{const a=this.getStatusText(e),s=this.getStatusText(t);return"진행중"===a&&"진행중"!==s?-1:"진행중"!==a&&"진행중"===s?1:"예정"===a&&"예정"!==s?-1:"예정"!==a&&"예정"===s?1:0}))},filteredTargets(e){const t=new Date;return this.adminTargets.filter((a=>{const s=new Date(a.end_date);return"finished"===e?t>s:t<=s}))},sortedAdminTargets(e){return e.sort(((e,t)=>e.mile_no-t.mile_no))},async loadUserParticipatedTargets(){try{const e=this.adminTargets.map((e=>e.target_no));console.log("5. Target numbers:",e);for(const t of e){const e=await this.checkParticipation(t);e&&this.userParticipatedTargets.push(t)}console.log("7. Updated userParticipatedTargets:",this.userParticipatedTargets)}catch(e){console.error("Failed to load user participated targets:",e)}finally{this.isLoading=!1}},async deleteTarget(e){qe().fire({title:"경고",text:"정말로 삭제하시겠습니까?",icon:"warning",showCancelButton:!0,scrollbarPadding:!1,confirmButtonText:"확인",cancelButtonText:"취소",reverseButtons:!1,willOpen:()=>{document.body.style.paddingRight="0px"},willClose:()=>{document.body.style.paddingRight="0px"}}).then((async t=>{if(t.isConfirmed)try{const t=this.$store.getters["login/getLoginInfo"].user_no;await this.$store.dispatch("target/deleteTarget",{userNo:t,targetNo:e}),qe().fire({title:"삭제 완료",text:"삭제가 완료되었습니다.",icon:"success",scrollbarPadding:!1,willOpen:()=>{document.body.style.paddingRight="0px"},willClose:()=>{document.body.style.paddingRight="0px"}})}catch(a){console.error("Error deleting target:",a),qe().fire({title:"오류 발생",text:"삭제 중 오류가 발생했습니다. 다시 시도해 주세요.",icon:"error",scrollbarPadding:!1,willOpen:()=>{document.body.style.paddingRight="0px"},willClose:()=>{document.body.style.paddingRight="0px"}})}else qe().fire({title:"취소됨",text:"삭제가 취소되었습니다.",icon:"info",scrollbarPadding:!1,willOpen:()=>{document.body.style.paddingRight="0px"},willClose:()=>{document.body.style.paddingRight="0px"}})}))},showAlert(e,t){this.$swal({title:e,icon:t,confirmButtonText:"확인",confirmButtonColor:"#4b4a4a",allowOutsideClick:!1,allowEscapeKey:!1,allowEnterKey:!1,stopKeydownPropagation:!1,scrollbarPadding:!1,backdrop:!0,didOpen:()=>{document.body.classList.add("no-scroll"),document.documentElement.style.overflow="hidden"},willClose:()=>{document.body.classList.remove("no-scroll"),document.documentElement.style.overflow=""}})},applyFadeUpEffect(){console.log("Applying fade-up effect");const e=this.$el.querySelectorAll(".fade-up-item");console.log(`Found ${e.length} items to animate`),e.forEach(((t,a)=>{t.style.setProperty("--index",a),t.style.setProperty("z-index",e.length-a);const s=50,i=s+50*a;setTimeout((()=>{t.classList.add("fade-up-active")}),i)}))}},async created(){console.log("targer loginInfo 이 찍히나요 ?:",this.loginInfo),console.log("isLoggedIn:",this.isLoggedIn),console.log("isChecked:",this.isChecked),this.isLoading=!0;try{await this.fetchMileages(),await this.fetchPersonalTargets(this.loginInfo.user_no).then((()=>{console.log("Targets after fetch:",this.getPersonalTargets)}))}catch(e){console.error("Error initializing component:",e)}finally{this.isLoading=!1}},computed:{...(0,q.L8)("login",["getLoginInfo","getIsChecked"]),...(0,q.aH)("login",["loginInfo"]),...(0,q.L8)("target",["getPersonalTargets"]),adminTargets(){return this.getPersonalTargets||[]},displayedTargets(){const e=this.filteredTargets(this.sortBy),t=this.sortedAdminTargets(e);return"not-finished"===this.sortBy?this.sortTargets(t):t},totalTargetsCount(){return this.displayedTargets.length},targets(){const e=this.getPersonalTargets;return console.log("Targets:",e),Array.isArray(e)?e:[]},filteredMileages(){const e=new Date,t=[...this.targets].sort(((e,t)=>e.mile_no-t.mile_no)).sort(((e,t)=>{const a=this.getStatusText(e),s=this.getStatusText(t);return"진행중"===a&&"진행중"!==s?-1:"진행중"!==a&&"진행중"===s?1:"예정"===a&&"예정"!==s?-1:"예정"!==a&&"예정"===s?1:0}));return t.filter((t=>{if(!t||!t.end_date)return console.warn("Skipping mileage due to missing endDate:",t),!1;const a=new Date(t.end_date);return isNaN(a.getTime())?(console.warn("Invalid date format in endDate:",t.end_date),!1):"finished"===this.sortBy?a<e:"not-finished"!==this.sortBy||a>=e}))}},watch:{getLoginInfo:{immediate:!0,handler(e){e&&e.user_no?(console.log("Calling getAdminTargets with user_no:",e.user_no),this.fetchPersonalTargets(e.user_no).then((()=>{this.isLoading=!1,this.$nextTick((()=>{this.applyFadeUpEffect()}))}))):this.dataLoaded=!1}},sortBy(){this.$nextTick((()=>{this.applyFadeUpEffect()}))}}};const Ye=(0,G.A)(Je,[["render",He],["__scopeId","data-v-79019f20"]]);var Ge=Ye,Ze={name:"MyMileageTarget",components:{TogetherTarget:ee,PersonalTarget:Ge},data(){return{activeTab:"together",showHelpPopover:!1}},methods:{setActiveTab(e){this.activeTab=e,this.$router.push({query:{tab:e}})},toggleHelpPopover(e){e.stopPropagation(),console.log("toggleHelpPopover 클릭"),this.showHelpPopover=!this.showHelpPopover,console.log("showHelpPopover:",this.showHelpPopover),this.showHelpPopover?document.addEventListener("click",this.handleClickOutside):document.removeEventListener("click",this.handleClickOutside)},handleClickOutside(e){console.log("handleClickOutside 실행"),!this.$refs.helpPopover||this.$refs.helpPopover.contains(e.target)||this.$refs.helpIcon.contains(e.target)||(console.log("팝오버 닫기"),this.showHelpPopover=!1,document.removeEventListener("click",this.handleClickOutside))}},created(){},computed:{currentComponent(){switch(this.activeTab){case"together":return"TogetherTarget";case"personal":return"PersonalTarget";default:return"TogetherTarget"}}},watch:{"$route.query.tab":{immediate:!0,handler(e){e&&(this.activeTab=e)}}}};const et=(0,G.A)(Ze,[["render",p],["__scopeId","data-v-58cff39a"]]);var tt=et}}]);
//# sourceMappingURL=7333.119cfd08.js.map