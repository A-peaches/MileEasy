"use strict";(self["webpackChunkmile"]=self["webpackChunkmile"]||[]).push([[9594],{39594:function(t,e,a){a.r(e),a.d(e,{default:function(){return nt}});var s=a(20641),i=a(53751),n=a(90033);const l=t=>((0,s.Qi)("data-v-4d7a3809"),t=t(),(0,s.jt)(),t),o={class:"cards page-back mx-auto"},r=l((()=>(0,s.Lk)("h2",{class:"bold-x-lg my-5",style:{"font-family":"KB_C3"}},"ëª©í‘œ ê´€ë¦¬",-1))),d={class:"menu-and-filters"},c={class:"search-filters"},g=l((()=>(0,s.Lk)("option",{value:""},"ëª¨ë“  ìƒíƒœ",-1))),h=l((()=>(0,s.Lk)("option",{value:"ongoing"},"ì§„í–‰ ì¤‘",-1))),u=l((()=>(0,s.Lk)("option",{value:"scheduled"},"ì˜ˆì •",-1))),p=l((()=>(0,s.Lk)("option",{value:"completed"},"ì¢…ë£Œ",-1))),m=[g,h,u,p],f={class:"d-flex justify-content-end mr-5"},k={key:0,class:"goals-list"},v=["onClick"],D={class:"goal-date"},_={class:"goal-mileage"},L={class:"goal-rate"},y={class:"progress-container"},x={class:"goal-details"},C={style:{"margin-top":"40px"}},T={style:{"font-size":"20px","font-family":"'KB_C2', sans-serif","margin-right":"70px"}},w=l((()=>(0,s.Lk)("i",{class:"bi bi-person-fill-check",style:{color:"#19c99b","font-size":"27px","margin-right":"10px"}},null,-1))),b=l((()=>(0,s.Lk)("span",{style:{"font-size":"20px","font-family":"'KB_C2', sans-serif",color:"#19c99b"}},"ë‹¬ì„± ",-1))),I={style:{"font-size":"20px","font-family":"'KB_C2', sans-serif",color:"#19c99b","margin-right":"70px"}},S=l((()=>(0,s.Lk)("i",{class:"bi bi-person-fill-x",style:{color:"#cf2222","font-size":"27px","margin-right":"10px"}},null,-1))),A=l((()=>(0,s.Lk)("span",{style:{"font-size":"20px","font-family":"'KB_C2', sans-serif",color:"#cf2222"}},"ë¯¸ë‹¬ì„± ",-1))),M={style:{"font-size":"20px","font-family":"'KB_C2', sans-serif",color:"#cf2222","margin-right":"70px"}},E=l((()=>(0,s.Lk)("i",{class:"bi bi-envelope-check-fill",style:{color:"#8c8c8c","font-size":"27px","margin-top":"10px","margin-right":"10px"}},null,-1))),P=["onClick"],B={key:1,style:{"font-size":"18px","font-family":"'KB_C2', sans-serif","margin-right":"70px"}},$=["onClick"],z={key:2,class:"loading-dots"},K={key:1},V=l((()=>(0,s.Lk)("p",null,"ì°¸ê°€ìê°€ ì—†ìŠµë‹ˆë‹¤.",-1))),O=[V],X={key:0,class:"modal-overlay"},U={class:"modal-content"},F={class:"modal-header"},W={class:"modal-title"},J={class:"modal-body"},Q={class:"form-group"},j=l((()=>(0,s.Lk)("label",null,"ëª©í‘œ ê¸°ê°„",-1))),R={class:"date-range"},G=l((()=>(0,s.Lk)("span",{class:"date-separator"},"~",-1))),N={class:"form-group"},Y=l((()=>(0,s.Lk)("label",{for:"mileage-score"},"ëª©í‘œ ë§ˆì¼ë¦¬ì§€ ì ìˆ˜",-1))),q={class:"modal-footer"};function H(t,e,a,l,g,h){const u=(0,s.g2)("Datepicker");return(0,s.uX)(),(0,s.CE)(s.FK,null,[(0,s.Lk)("div",o,[r,(0,s.Lk)("div",d,[(0,s.Lk)("div",c,[(0,s.bo)((0,s.Lk)("input",{type:"date","onUpdate:modelValue":e[0]||(e[0]=t=>g.searchStartDate=t),onChange:e[1]||(e[1]=(...t)=>h.filterTargets&&h.filterTargets(...t)),placeholder:"ì‹œì‘ ë‚ ì§œ"},null,544),[[i.Jo,g.searchStartDate]]),(0,s.bo)((0,s.Lk)("input",{type:"date","onUpdate:modelValue":e[2]||(e[2]=t=>g.searchEndDate=t),onChange:e[3]||(e[3]=(...t)=>h.filterTargets&&h.filterTargets(...t)),placeholder:"ì¢…ë£Œ ë‚ ì§œ"},null,544),[[i.Jo,g.searchEndDate]]),(0,s.bo)((0,s.Lk)("select",{"onUpdate:modelValue":e[4]||(e[4]=t=>g.searchStatus=t),onChange:e[5]||(e[5]=(...t)=>h.filterTargets&&h.filterTargets(...t))},m,544),[[i.u1,g.searchStatus]])])]),(0,s.Lk)("div",f,[(0,s.Lk)("div",{class:"target",onClick:e[6]||(e[6]=(...t)=>h.openModal&&h.openModal(...t)),style:{cursor:"pointer"}}," ğŸ“ ëª©í‘œ ë“±ë¡ ")]),h.filteredTargets.length>0?((0,s.uX)(),(0,s.CE)("div",k,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(h.filteredTargets,((t,e)=>((0,s.uX)(),(0,s.CE)("div",{key:e,class:"goal-card"},[(0,s.Lk)("div",{class:"goal-info",onClick:t=>h.toggleExpand(e)},[(0,s.Lk)("span",D,"ğŸ“… "+(0,n.v_)(t.start_date)+" ~ "+(0,n.v_)(t.end_date),1),(0,s.Lk)("span",_,"ğŸ¯ "+(0,n.v_)(t.target_mileage)+" ë§ˆì¼ë¦¬ì§€ ëª©í‘œ",1),(0,s.Lk)("span",{class:(0,n.C4)(["goal-status",{"status-completed":h.isCompleted(t),"status-ongoing":h.isOngoing(t),"status-scheduled":h.isScheduled(t)}])},(0,n.v_)(h.getStatusText(t)),3),(0,s.Lk)("span",L,"âœ¨ "+(0,n.v_)(t.totalParticipants>0?Math.round(t.achievedCount/t.totalParticipants*100):0)+"% ë‹¬ì„± ",1)],8,v),(0,s.Lk)("div",y,[(0,s.Lk)("div",{class:"progress-bar",style:(0,n.Tr)({width:g.animatedWidths[e]+"%"})},null,4)]),(0,s.bo)((0,s.Lk)("div",x,[(0,s.Lk)("div",C,[(0,s.Lk)("span",T,"ì°¸ê°€ì "+(0,n.v_)(t.totalParticipants)+" ëª…",1),w,b,(0,s.Lk)("span",I,(0,n.v_)(t.achievedCount)+" ëª…",1),S,A,(0,s.Lk)("span",M,(0,n.v_)(t.notAchievedCount)+" ëª…",1),E,h.isOngoing(t)?((0,s.uX)(),(0,s.CE)("span",{key:0,onClick:a=>h.generateAIContent(t,e),style:{cursor:"pointer","font-size":"18px","font-family":"'KB_C2', sans-serif","margin-right":"70px"}}," ë¬¸ì ë°œì†¡",8,P)):((0,s.uX)(),(0,s.CE)("span",B," ë¬¸ìë°œì†¡ ë¶ˆê°€ ")),(0,s.Lk)("span",{style:{"font-size":"18px","font-family":"'KB_C2', sans-serif",color:"#cf2222",cursor:"pointer"},onClick:e=>h.deleteTarget(t.target_no)},"ì‚­ì œ",8,$),g.loading[e]?((0,s.uX)(),(0,s.CE)("span",z,(0,n.v_)(g.loadingText[e]),1)):(0,s.Q3)("",!0)])],512),[[i.aG,g.expandedTargets.includes(t.target_no)]])])))),128))])):((0,s.uX)(),(0,s.CE)("div",K,O))]),g.isModalOpen?((0,s.uX)(),(0,s.CE)("div",X,[(0,s.Lk)("div",U,[(0,s.Lk)("div",F,[(0,s.Lk)("h2",W,(0,n.v_)(g.mile_name)+" ëª©í‘œ ë“±ë¡í•˜ê¸°",1),(0,s.Lk)("button",{class:"close-button",onClick:e[7]||(e[7]=(...t)=>h.closeModal&&h.closeModal(...t))},"Ã—")]),(0,s.Lk)("div",J,[(0,s.Lk)("div",Q,[j,(0,s.Lk)("div",R,[(0,s.bF)(u,{modelValue:g.startDate,"onUpdate:modelValue":e[8]||(e[8]=t=>g.startDate=t),format:h.formatDate,placeholder:"ì‹œì‘ì¼",minDate:new Date},null,8,["modelValue","format","minDate"]),G,(0,s.bF)(u,{modelValue:g.endDate,"onUpdate:modelValue":e[9]||(e[9]=t=>g.endDate=t),format:h.formatDate,placeholder:"ì¢…ë£Œì¼",minDate:new Date},null,8,["modelValue","format","minDate"])])]),(0,s.Lk)("div",N,[Y,(0,s.bo)((0,s.Lk)("input",{type:"number",id:"mileage-score","onUpdate:modelValue":e[10]||(e[10]=t=>g.targetScore=t)},null,512),[[i.Jo,g.targetScore]])])]),(0,s.Lk)("div",q,[(0,s.Lk)("button",{class:"submit-button",onClick:e[11]||(e[11]=(...t)=>h.addAction&&h.addAction(...t))},"ë“±ë¡")])])])):(0,s.Q3)("",!0)],64)}a(44114);var Z=a(66278),tt=a(66652),et=a(37682),at={name:"TargetMileageAdminView",components:{Datepicker:tt.A},data(){return{isModalOpen:!1,startDate:null,endDate:null,targetScore:0,mile_name:"",searchStartDate:"",searchEndDate:"",searchStatus:"",expandedTargets:[],loading:[],loadingText:[],loadingInterval:[],animatedWidths:[]}},computed:{...(0,Z.L8)("mile",["getMileInfo","getArrayMiles"]),...(0,Z.L8)("login",["getLoginInfo"]),...(0,Z.L8)("mileage",["getTargets"]),...(0,Z.L8)("target",["getParticipantsData"]),participantsData(){return this.getParticipantsData(this.targetNo)},targets(){return this.getTargets||[]},loginInfo(){return this.getLoginInfo},mileInfo(){return this.getMileInfo},formattedTargets(){return this.targets?this.targets.map((t=>{const e=new Date(t.start_date),a=new Date(t.end_date);return{...t,targetRate:t.achievementRate,startDate:e,endDate:a,animatedWidth:0}})):[]},filteredTargets(){let t=this.formattedTargets;if(this.searchStatus&&(t=t.filter((t=>"ongoing"===this.searchStatus?this.isOngoing(t):"scheduled"===this.searchStatus?this.isScheduled(t):"completed"!==this.searchStatus||this.isCompleted(t)))),this.searchStartDate&&this.searchEndDate){const e=new Date(this.searchStartDate),a=new Date(this.searchEndDate);t=t.filter((t=>{const s=new Date(t.start_date),i=new Date(t.end_date);return s>=e&&i<=a}))}return t.sort(((t,e)=>new Date(t.start_date)-new Date(e.start_date)))}},methods:{...(0,Z.i0)("mile",["fetchMileInfo"]),...(0,Z.i0)("mileage",["addTarget","fetchMileTarget","targetDelete"]),warningAlert(t){this.$swal({title:"ê²½ê³ ",text:t,icon:"warning",scrollbarPadding:!1})},succesAlert(){this.$swal({title:"ì„±ê³µ",text:"ë©”ì‹œì§€ ë°œì†¡ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤.",icon:"success",scrollbarPadding:!1})},targetAlert(){this.$swal({title:"ì„±ê³µ",text:"ìƒˆë¡œìš´ ëª©í‘œê°€ ë“±ë¡ë˜ì—ˆìŠµë‹ˆë‹¤.",icon:"success",scrollbarPadding:!1})},deleteAlert(){this.$swal({title:"ì„±ê³µ",text:"ì‚­ì œê°€ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤.",icon:"success",scrollbarPadding:!1})},errorAlert(t){alert(`ì—ëŸ¬: ${t}`)},startLoadingAnimation(t){let e="";this.loading[t]=!0,this.loadingInterval[t]=setInterval((()=>{e.length<3?e+=".":e="",this.loadingText[t]="ì¤‘"+e}),500)},async generateAIContent(t,e){try{this.startLoadingAnimation(e);let a=t.not_achieved_names||"",s=t.not_achieved_phones||"";if("string"===typeof a&&(a=a.split(",").map((t=>t.trim())).filter((t=>t.length>0))),"string"===typeof s&&(s=s.split(",").map((t=>t.trim())).filter((t=>t.length>0))),0===s.length||0===a.length)return this.loading[e]=!1,clearInterval(this.loadingInterval[e]),this.loadingText[e]="",void this.warningAlert("ë°œì†¡í•  ëŒ€ìƒì´ ì—†ìŠµë‹ˆë‹¤.");const i=await et.A.post("bot/sms",null,{params:{prompt:`ìš°ë¦¬ íšŒì‚¬ ì¸ì‚¬ê³ ê³¼ì™€ ì—°ê²°ë˜ëŠ” ë§ˆì¼ë¦¬ì§€ ê´€ë¦¬ ì‚¬ì´íŠ¸ì—ì„œ ${t.mile_name} ë§ˆì¼ë¦¬ì§€ì— ê´€í•´ì„œ í™ë³´ì„± ë¬¸ìë©”ì‹œì§€ë¥¼ ë§Œë“¤ì–´ì¤˜.ë§ˆì¼ë¦¬ì§€ê°€ ${t.end_date}ê¹Œì§€ ë‹¬ì„±ë˜ì§€ ì•Šìœ¼ë©´ ë§ˆì™• ì ìˆ˜ë¥¼ íšë“í•  ìˆ˜ ì—†ë‹¤ëŠ” ì†Œì‹ë„ ì•Œë ¤ì¤˜.íšŒì‚¬ ì´ë¦„ì€ ì•ˆ ë°íˆì§€ ì•Šê³  100ì ì´ë‚´ë¡œ ë³´ë‚´ì¤˜.ë§ˆë¬´ë¦¬ ë©˜íŠ¸ëŠ” í™œê¸°ì°¨ê²Œ ë„ì „í•´ë³´ìëŠ” ë‚´ìš©ìœ¼ë¡œ !ë¥¼ ë„£ì—ˆìœ¼ë©´ ì¢‹ê² ì–´ì¼ìƒìƒí™œ ì†ì—ì„œ ì“°ì§€ ì•ŠëŠ” ì–´ë ¤ìš´ ë‹¨ì–´ëŠ” ì“°ì§€ ë§ì•„ì¤˜`}}),n=i.data,l=s.map((t=>({to:t,text:n})));await et.A.post("/user/sendSmsAction",{to:l.map((t=>t.to)),texts:l.map((t=>t.text)),mile:t.mile_name}),this.loading[e]=!1,clearInterval(this.loadingInterval[e]),this.loadingText[e]="",this.succesAlert()}catch(a){this.loading[e]=!1,clearInterval(this.loadingInterval[e]),this.loadingText[e]="",this.errorAlert(a.message||"ë¬¸ì ë°œì†¡ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.")}},animateProgressBars(){this.filteredTargets.forEach(((t,e)=>{const a=t.totalParticipants>0?Math.round(t.achievedCount/t.totalParticipants*100):0;let s=0;this.animatedWidths[e]=s;const i=setInterval((()=>{s<a?(s+=1,this.animatedWidths[e]=s):clearInterval(i)}),2)}))},resetModalData(){this.startDate=null,this.endDate=null,this.targetScore=0},async addAction(){const t={mile_no:this.loginInfo.mile_no,user_no:this.loginInfo.user_no,start_date:this.formatDate(this.startDate),end_date:this.formatDate(this.endDate),target_mileage:this.targetScore},e=await this.addTarget(t);e&&e.data.success?(this.targetAlert(),this.resetModalData(),this.closeModal(),await this.refreshTargets()):this.errorAlert("ëª©í‘œ ë“±ë¡ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤","fail","#")},openModal(){this.isModalOpen=!0},closeModal(){this.isModalOpen=!1},showAlert(t,e,a=null){this.$swal({icon:t,title:e,showConfirmButton:!1,timer:1500}).then((()=>{a&&this.navigateTo(a)}))},navigateTo(t){t&&this.$router.push(t)},async deleteTarget(t){console.log("target_no::",t);const e=await this.targetDelete(t);window.location.reload(),e&&e.data.success?window.location.reload():this.errorAlert("ëª©í‘œ ì‚­ì œì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤","fail","#")},formatDate(t){const e=t.getFullYear(),a=String(t.getMonth()+1).padStart(2,"0"),s=String(t.getDate()).padStart(2,"0");return`${e}-${a}-${s}`},isOngoing(t){const e=new Date;return t.startDate<=e&&e<=t.endDate},isScheduled(t){const e=new Date;return t.startDate>e},isCompleted(t){const e=new Date;return t.endDate<e},getStatusText(t){return this.isOngoing(t)?"ì§„í–‰ ì¤‘":this.isScheduled(t)?"ì˜ˆì •":this.isCompleted(t)?"ì¢…ë£Œ":"ì•Œ ìˆ˜ ì—†ìŒ"},filterTargets(){},toggleExpand(t){const e=this.filteredTargets[t].target_no,a=this.expandedTargets.indexOf(e);-1===a?this.expandedTargets=[e]:this.expandedTargets.splice(a,1)},async refreshTargets(){const t=this.loginInfo?this.loginInfo.mile_no:null;if(t)try{await this.fetchMileTarget(t),this.animateProgressBars()}catch(e){console.error("ëª©í‘œ ëª©ë¡ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤:",e)}}},async created(){const t=this.loginInfo?this.loginInfo.user_no:null;if(t){await this.fetchMileInfo(t);const e=this.getMileInfo;e?this.mile_name=e.mile_no:console.error("ë§ˆì¼ë¦¬ì§€ ì´ë¦„ì„ ê°€ì ¸ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.")}else console.error("user_noì´ ìœ íš¨í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.");const e=this.loginInfo?this.loginInfo.mile_no:null;if(e)try{await this.fetchMileTarget(e),this.animateProgressBars()}catch(a){console.error("ë§ˆì¼ë¦¬ì§€ ëª©í‘œ ë¦¬ìŠ¤íŠ¸ë¥¼ ê°€ì ¸ì˜¤ëŠ” ì¤‘ ì˜¤ë¥˜ ë°œìƒ:",a)}else console.error("mile_noê°€ ìœ íš¨í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.")}},st=a(66262);const it=(0,st.A)(at,[["render",H],["__scopeId","data-v-4d7a3809"]]);var nt=it}}]);
//# sourceMappingURL=9594.589629e5.js.map