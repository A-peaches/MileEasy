"use strict";(self["webpackChunkmile"]=self["webpackChunkmile"]||[]).push([[9594],{39594:function(t,e,a){a.r(e),a.d(e,{default:function(){return nt}});var s=a(20641),i=a(53751),n=a(90033);const l=t=>((0,s.Qi)("data-v-4d7a3809"),t=t(),(0,s.jt)(),t),o={class:"cards page-back mx-auto"},r=l((()=>(0,s.Lk)("h2",{class:"bold-x-lg my-5",style:{"font-family":"KB_C3"}},"목표 관리",-1))),d={class:"menu-and-filters"},c={class:"search-filters"},g=l((()=>(0,s.Lk)("option",{value:""},"모든 상태",-1))),h=l((()=>(0,s.Lk)("option",{value:"ongoing"},"진행 중",-1))),u=l((()=>(0,s.Lk)("option",{value:"scheduled"},"예정",-1))),p=l((()=>(0,s.Lk)("option",{value:"completed"},"종료",-1))),m=[g,h,u,p],f={class:"d-flex justify-content-end mr-5"},k={key:0,class:"goals-list"},v=["onClick"],D={class:"goal-date"},_={class:"goal-mileage"},L={class:"goal-rate"},y={class:"progress-container"},x={class:"goal-details"},C={style:{"margin-top":"40px"}},T={style:{"font-size":"20px","font-family":"'KB_C2', sans-serif","margin-right":"70px"}},w=l((()=>(0,s.Lk)("i",{class:"bi bi-person-fill-check",style:{color:"#19c99b","font-size":"27px","margin-right":"10px"}},null,-1))),b=l((()=>(0,s.Lk)("span",{style:{"font-size":"20px","font-family":"'KB_C2', sans-serif",color:"#19c99b"}},"달성 ",-1))),I={style:{"font-size":"20px","font-family":"'KB_C2', sans-serif",color:"#19c99b","margin-right":"70px"}},S=l((()=>(0,s.Lk)("i",{class:"bi bi-person-fill-x",style:{color:"#cf2222","font-size":"27px","margin-right":"10px"}},null,-1))),A=l((()=>(0,s.Lk)("span",{style:{"font-size":"20px","font-family":"'KB_C2', sans-serif",color:"#cf2222"}},"미달성 ",-1))),M={style:{"font-size":"20px","font-family":"'KB_C2', sans-serif",color:"#cf2222","margin-right":"70px"}},E=l((()=>(0,s.Lk)("i",{class:"bi bi-envelope-check-fill",style:{color:"#8c8c8c","font-size":"27px","margin-top":"10px","margin-right":"10px"}},null,-1))),P=["onClick"],B={key:1,style:{"font-size":"18px","font-family":"'KB_C2', sans-serif","margin-right":"70px"}},$=["onClick"],z={key:2,class:"loading-dots"},K={key:1},V=l((()=>(0,s.Lk)("p",null,"참가자가 없습니다.",-1))),O=[V],X={key:0,class:"modal-overlay"},U={class:"modal-content"},F={class:"modal-header"},W={class:"modal-title"},J={class:"modal-body"},Q={class:"form-group"},j=l((()=>(0,s.Lk)("label",null,"목표 기간",-1))),R={class:"date-range"},G=l((()=>(0,s.Lk)("span",{class:"date-separator"},"~",-1))),N={class:"form-group"},Y=l((()=>(0,s.Lk)("label",{for:"mileage-score"},"목표 마일리지 점수",-1))),q={class:"modal-footer"};function H(t,e,a,l,g,h){const u=(0,s.g2)("Datepicker");return(0,s.uX)(),(0,s.CE)(s.FK,null,[(0,s.Lk)("div",o,[r,(0,s.Lk)("div",d,[(0,s.Lk)("div",c,[(0,s.bo)((0,s.Lk)("input",{type:"date","onUpdate:modelValue":e[0]||(e[0]=t=>g.searchStartDate=t),onChange:e[1]||(e[1]=(...t)=>h.filterTargets&&h.filterTargets(...t)),placeholder:"시작 날짜"},null,544),[[i.Jo,g.searchStartDate]]),(0,s.bo)((0,s.Lk)("input",{type:"date","onUpdate:modelValue":e[2]||(e[2]=t=>g.searchEndDate=t),onChange:e[3]||(e[3]=(...t)=>h.filterTargets&&h.filterTargets(...t)),placeholder:"종료 날짜"},null,544),[[i.Jo,g.searchEndDate]]),(0,s.bo)((0,s.Lk)("select",{"onUpdate:modelValue":e[4]||(e[4]=t=>g.searchStatus=t),onChange:e[5]||(e[5]=(...t)=>h.filterTargets&&h.filterTargets(...t))},m,544),[[i.u1,g.searchStatus]])])]),(0,s.Lk)("div",f,[(0,s.Lk)("div",{class:"target",onClick:e[6]||(e[6]=(...t)=>h.openModal&&h.openModal(...t)),style:{cursor:"pointer"}}," 📝 목표 등록 ")]),h.filteredTargets.length>0?((0,s.uX)(),(0,s.CE)("div",k,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(h.filteredTargets,((t,e)=>((0,s.uX)(),(0,s.CE)("div",{key:e,class:"goal-card"},[(0,s.Lk)("div",{class:"goal-info",onClick:t=>h.toggleExpand(e)},[(0,s.Lk)("span",D,"📅 "+(0,n.v_)(t.start_date)+" ~ "+(0,n.v_)(t.end_date),1),(0,s.Lk)("span",_,"🎯 "+(0,n.v_)(t.target_mileage)+" 마일리지 목표",1),(0,s.Lk)("span",{class:(0,n.C4)(["goal-status",{"status-completed":h.isCompleted(t),"status-ongoing":h.isOngoing(t),"status-scheduled":h.isScheduled(t)}])},(0,n.v_)(h.getStatusText(t)),3),(0,s.Lk)("span",L,"✨ "+(0,n.v_)(t.totalParticipants>0?Math.round(t.achievedCount/t.totalParticipants*100):0)+"% 달성 ",1)],8,v),(0,s.Lk)("div",y,[(0,s.Lk)("div",{class:"progress-bar",style:(0,n.Tr)({width:g.animatedWidths[e]+"%"})},null,4)]),(0,s.bo)((0,s.Lk)("div",x,[(0,s.Lk)("div",C,[(0,s.Lk)("span",T,"참가자 "+(0,n.v_)(t.totalParticipants)+" 명",1),w,b,(0,s.Lk)("span",I,(0,n.v_)(t.achievedCount)+" 명",1),S,A,(0,s.Lk)("span",M,(0,n.v_)(t.notAchievedCount)+" 명",1),E,h.isOngoing(t)?((0,s.uX)(),(0,s.CE)("span",{key:0,onClick:a=>h.generateAIContent(t,e),style:{cursor:"pointer","font-size":"18px","font-family":"'KB_C2', sans-serif","margin-right":"70px"}}," 문자 발송",8,P)):((0,s.uX)(),(0,s.CE)("span",B," 문자발송 불가 ")),(0,s.Lk)("span",{style:{"font-size":"18px","font-family":"'KB_C2', sans-serif",color:"#cf2222",cursor:"pointer"},onClick:e=>h.deleteTarget(t.target_no)},"삭제",8,$),g.loading[e]?((0,s.uX)(),(0,s.CE)("span",z,(0,n.v_)(g.loadingText[e]),1)):(0,s.Q3)("",!0)])],512),[[i.aG,g.expandedTargets.includes(t.target_no)]])])))),128))])):((0,s.uX)(),(0,s.CE)("div",K,O))]),g.isModalOpen?((0,s.uX)(),(0,s.CE)("div",X,[(0,s.Lk)("div",U,[(0,s.Lk)("div",F,[(0,s.Lk)("h2",W,(0,n.v_)(g.mile_name)+" 목표 등록하기",1),(0,s.Lk)("button",{class:"close-button",onClick:e[7]||(e[7]=(...t)=>h.closeModal&&h.closeModal(...t))},"×")]),(0,s.Lk)("div",J,[(0,s.Lk)("div",Q,[j,(0,s.Lk)("div",R,[(0,s.bF)(u,{modelValue:g.startDate,"onUpdate:modelValue":e[8]||(e[8]=t=>g.startDate=t),format:h.formatDate,placeholder:"시작일",minDate:new Date},null,8,["modelValue","format","minDate"]),G,(0,s.bF)(u,{modelValue:g.endDate,"onUpdate:modelValue":e[9]||(e[9]=t=>g.endDate=t),format:h.formatDate,placeholder:"종료일",minDate:new Date},null,8,["modelValue","format","minDate"])])]),(0,s.Lk)("div",N,[Y,(0,s.bo)((0,s.Lk)("input",{type:"number",id:"mileage-score","onUpdate:modelValue":e[10]||(e[10]=t=>g.targetScore=t)},null,512),[[i.Jo,g.targetScore]])])]),(0,s.Lk)("div",q,[(0,s.Lk)("button",{class:"submit-button",onClick:e[11]||(e[11]=(...t)=>h.addAction&&h.addAction(...t))},"등록")])])])):(0,s.Q3)("",!0)],64)}a(44114);var Z=a(66278),tt=a(66652),et=a(37682),at={name:"TargetMileageAdminView",components:{Datepicker:tt.A},data(){return{isModalOpen:!1,startDate:null,endDate:null,targetScore:0,mile_name:"",searchStartDate:"",searchEndDate:"",searchStatus:"",expandedTargets:[],loading:[],loadingText:[],loadingInterval:[],animatedWidths:[]}},computed:{...(0,Z.L8)("mile",["getMileInfo","getArrayMiles"]),...(0,Z.L8)("login",["getLoginInfo"]),...(0,Z.L8)("mileage",["getTargets"]),...(0,Z.L8)("target",["getParticipantsData"]),participantsData(){return this.getParticipantsData(this.targetNo)},targets(){return this.getTargets||[]},loginInfo(){return this.getLoginInfo},mileInfo(){return this.getMileInfo},formattedTargets(){return this.targets?this.targets.map((t=>{const e=new Date(t.start_date),a=new Date(t.end_date);return{...t,targetRate:t.achievementRate,startDate:e,endDate:a,animatedWidth:0}})):[]},filteredTargets(){let t=this.formattedTargets;if(this.searchStatus&&(t=t.filter((t=>"ongoing"===this.searchStatus?this.isOngoing(t):"scheduled"===this.searchStatus?this.isScheduled(t):"completed"!==this.searchStatus||this.isCompleted(t)))),this.searchStartDate&&this.searchEndDate){const e=new Date(this.searchStartDate),a=new Date(this.searchEndDate);t=t.filter((t=>{const s=new Date(t.start_date),i=new Date(t.end_date);return s>=e&&i<=a}))}return t.sort(((t,e)=>new Date(t.start_date)-new Date(e.start_date)))}},methods:{...(0,Z.i0)("mile",["fetchMileInfo"]),...(0,Z.i0)("mileage",["addTarget","fetchMileTarget","targetDelete"]),warningAlert(t){this.$swal({title:"경고",text:t,icon:"warning",scrollbarPadding:!1})},succesAlert(){this.$swal({title:"성공",text:"메시지 발송이 완료되었습니다.",icon:"success",scrollbarPadding:!1})},targetAlert(){this.$swal({title:"성공",text:"새로운 목표가 등록되었습니다.",icon:"success",scrollbarPadding:!1})},deleteAlert(){this.$swal({title:"성공",text:"삭제가 완료되었습니다.",icon:"success",scrollbarPadding:!1})},errorAlert(t){alert(`에러: ${t}`)},startLoadingAnimation(t){let e="";this.loading[t]=!0,this.loadingInterval[t]=setInterval((()=>{e.length<3?e+=".":e="",this.loadingText[t]="중"+e}),500)},async generateAIContent(t,e){try{this.startLoadingAnimation(e);let a=t.not_achieved_names||"",s=t.not_achieved_phones||"";if("string"===typeof a&&(a=a.split(",").map((t=>t.trim())).filter((t=>t.length>0))),"string"===typeof s&&(s=s.split(",").map((t=>t.trim())).filter((t=>t.length>0))),0===s.length||0===a.length)return this.loading[e]=!1,clearInterval(this.loadingInterval[e]),this.loadingText[e]="",void this.warningAlert("발송할 대상이 없습니다.");const i=await et.A.post("bot/sms",null,{params:{prompt:`우리 회사 인사고과와 연결되는 마일리지 관리 사이트에서 ${t.mile_name} 마일리지에 관해서 홍보성 문자메시지를 만들어줘.마일리지가 ${t.end_date}까지 달성되지 않으면 마왕 점수를 획득할 수 없다는 소식도 알려줘.회사 이름은 안 밝히지 않고 100자 이내로 보내줘.마무리 멘트는 활기차게 도전해보자는 내용으로 !를 넣었으면 좋겠어일상생활 속에서 쓰지 않는 어려운 단어는 쓰지 말아줘`}}),n=i.data,l=s.map((t=>({to:t,text:n})));await et.A.post("/user/sendSmsAction",{to:l.map((t=>t.to)),texts:l.map((t=>t.text)),mile:t.mile_name}),this.loading[e]=!1,clearInterval(this.loadingInterval[e]),this.loadingText[e]="",this.succesAlert()}catch(a){this.loading[e]=!1,clearInterval(this.loadingInterval[e]),this.loadingText[e]="",this.errorAlert(a.message||"문자 발송 중 오류가 발생했습니다.")}},animateProgressBars(){this.filteredTargets.forEach(((t,e)=>{const a=t.totalParticipants>0?Math.round(t.achievedCount/t.totalParticipants*100):0;let s=0;this.animatedWidths[e]=s;const i=setInterval((()=>{s<a?(s+=1,this.animatedWidths[e]=s):clearInterval(i)}),2)}))},resetModalData(){this.startDate=null,this.endDate=null,this.targetScore=0},async addAction(){const t={mile_no:this.loginInfo.mile_no,user_no:this.loginInfo.user_no,start_date:this.formatDate(this.startDate),end_date:this.formatDate(this.endDate),target_mileage:this.targetScore},e=await this.addTarget(t);e&&e.data.success?(this.targetAlert(),this.resetModalData(),this.closeModal(),await this.refreshTargets()):this.errorAlert("목표 등록에 실패했습니다","fail","#")},openModal(){this.isModalOpen=!0},closeModal(){this.isModalOpen=!1},showAlert(t,e,a=null){this.$swal({icon:t,title:e,showConfirmButton:!1,timer:1500}).then((()=>{a&&this.navigateTo(a)}))},navigateTo(t){t&&this.$router.push(t)},async deleteTarget(t){console.log("target_no::",t);const e=await this.targetDelete(t);window.location.reload(),e&&e.data.success?window.location.reload():this.errorAlert("목표 삭제에 실패했습니다","fail","#")},formatDate(t){const e=t.getFullYear(),a=String(t.getMonth()+1).padStart(2,"0"),s=String(t.getDate()).padStart(2,"0");return`${e}-${a}-${s}`},isOngoing(t){const e=new Date;return t.startDate<=e&&e<=t.endDate},isScheduled(t){const e=new Date;return t.startDate>e},isCompleted(t){const e=new Date;return t.endDate<e},getStatusText(t){return this.isOngoing(t)?"진행 중":this.isScheduled(t)?"예정":this.isCompleted(t)?"종료":"알 수 없음"},filterTargets(){},toggleExpand(t){const e=this.filteredTargets[t].target_no,a=this.expandedTargets.indexOf(e);-1===a?this.expandedTargets=[e]:this.expandedTargets.splice(a,1)},async refreshTargets(){const t=this.loginInfo?this.loginInfo.mile_no:null;if(t)try{await this.fetchMileTarget(t),this.animateProgressBars()}catch(e){console.error("목표 목록을 불러오는 중 오류가 발생했습니다:",e)}}},async created(){const t=this.loginInfo?this.loginInfo.user_no:null;if(t){await this.fetchMileInfo(t);const e=this.getMileInfo;e?this.mile_name=e.mile_no:console.error("마일리지 이름을 가져올 수 없습니다.")}else console.error("user_no이 유효하지 않습니다.");const e=this.loginInfo?this.loginInfo.mile_no:null;if(e)try{await this.fetchMileTarget(e),this.animateProgressBars()}catch(a){console.error("마일리지 목표 리스트를 가져오는 중 오류 발생:",a)}else console.error("mile_no가 유효하지 않습니다.")}},st=a(66262);const it=(0,st.A)(at,[["render",H],["__scopeId","data-v-4d7a3809"]]);var nt=it}}]);
//# sourceMappingURL=9594.589629e5.js.map