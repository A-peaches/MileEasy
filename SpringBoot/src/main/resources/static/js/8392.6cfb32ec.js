"use strict";(self["webpackChunkmile"]=self["webpackChunkmile"]||[]).push([[8392],{8392:function(e,t,o){o.r(t),o.d(t,{default:function(){return M}});var a=o(641),n=o(33);const s=e=>((0,a.Qi)("data-v-5bf04205"),e=e(),(0,a.jt)(),e),l={class:"cards page-back mx-auto"},r={class:"bold-x-lg mt-5",style:{"font-family":"KB_C3","margin-bottom":"80px"}},i={key:0,class:"help-popover",ref:"helpPopover"},c={class:"popover-content"},u={class:"popover-title"},g={class:"popover-table"},h=s((()=>(0,a.Lk)("thead",null,[(0,a.Lk)("tr",null,[(0,a.Lk)("th",null,"마일리지명"),(0,a.Lk)("th",null,"가중치")])],-1))),p={class:"date-download-container"},d={class:"table-responsive"},k=s((()=>(0,a.Lk)("div",{class:"text-start text-gray mx-auto mt-3 custom-caption",style:{width:"90%"}},[(0,a.eW)(" * 본 데이터는 지역영업그룹별 가중치가 적용된 점수입니다. "),(0,a.Lk)("br"),(0,a.eW)(" * 마일리지는 기준일자의 마일리지 점수로 책정됩니다. 마일리지별 업데이트 날짜가 상이할 수 있습니다. ")],-1))),m={class:"table table-hover custom-table mx-auto",style:{width:"90%"}},L=s((()=>(0,a.Lk)("thead",null,[(0,a.Lk)("tr",null,[(0,a.Lk)("th",null,"마일리지 순위"),(0,a.Lk)("th",null,"직원번호"),(0,a.Lk)("th",null,"직원명"),(0,a.Lk)("th",null,"마일리지 합계")])],-1))),v={class:"rank-badge"},P={key:0},_={class:"pagination-container"},b={class:"pagination"},f=["disabled"],w=["onClick"],C=["disabled"];function y(e,t,o,s,y,D){const E=(0,a.g2)("Datepicker");return(0,a.uX)(),(0,a.CE)("div",l,[(0,a.Lk)("h2",r,[(0,a.eW)((0,n.v_)(e.getLoginInfo?.group_name)+" 마일리지 관리 ",1),(0,a.Lk)("i",{class:"bi bi-question-circle help-icon",onClick:t[0]||(t[0]=(...e)=>D.toggleHelpPopover&&D.toggleHelpPopover(...e)),style:{"font-size":"22pt"},ref:"helpIcon"},null,512)]),y.showHelpPopover?((0,a.uX)(),(0,a.CE)("div",i,[(0,a.Lk)("div",c,[(0,a.Lk)("h5",u,(0,n.v_)(e.getLoginInfo?.group_name)+" 현재 가중치",1),(0,a.Lk)("table",g,[h,(0,a.Lk)("tbody",null,[((0,a.uX)(!0),(0,a.CE)(a.FK,null,(0,a.pI)(y.groupWeight,(e=>((0,a.uX)(),(0,a.CE)("tr",{key:e.group_name},[(0,a.Lk)("td",null,(0,n.v_)(e?.mile_name),1),(0,a.Lk)("td",null,(0,n.v_)(e?.weight),1)])))),128))])])])],512)):(0,a.Q3)("",!0),(0,a.Lk)("div",p,[(0,a.bF)(E,{modelValue:y.selectedDate,"onUpdate:modelValue":t[1]||(t[1]=e=>y.selectedDate=e),format:D.formatDate,class:"custom-datepicker"},null,8,["modelValue","format"]),(0,a.Lk)("i",{class:"bi bi-download download-icon",onClick:t[2]||(t[2]=(...e)=>D.downloadExcel&&D.downloadExcel(...e))})]),(0,a.Lk)("div",d,[k,(0,a.Lk)("table",m,[L,(0,a.Lk)("tbody",null,[((0,a.uX)(!0),(0,a.CE)(a.FK,null,(0,a.pI)(D.paginatedGroupList,(e=>((0,a.uX)(),(0,a.CE)("tr",{key:e.user_no,class:(0,n.C4)({"top-three":e?.user_rank<=3})},[(0,a.Lk)("td",null,[(0,a.Lk)("span",v,(0,n.v_)(e?.user_rank)+"위",1)]),(0,a.Lk)("td",null,(0,n.v_)(e?.user_no),1),(0,a.Lk)("td",null,[e.user_rank<=3?((0,a.uX)(),(0,a.CE)("span",P,"👑")):(0,a.Q3)("",!0),(0,a.eW)(" "+(0,n.v_)(e?.user_name),1)]),(0,a.Lk)("td",null,[(0,a.Lk)("strong",null,(0,n.v_)(e?.total_sum)+"점",1)])],2)))),128))])])]),(0,a.Lk)("div",_,[(0,a.Lk)("div",b,[(0,a.Lk)("button",{onClick:t[3]||(t[3]=e=>D.changePage(y.currentPage-1)),disabled:1===y.currentPage,class:"arrow-button"},"<",8,f),((0,a.uX)(!0),(0,a.CE)(a.FK,null,(0,a.pI)(D.displayedPages,(e=>((0,a.uX)(),(0,a.CE)("button",{key:e,onClick:t=>D.changePage(e),class:(0,n.C4)({active:y.currentPage===e})},(0,n.v_)(e),11,w)))),128)),(0,a.Lk)("button",{onClick:t[4]||(t[4]=e=>D.changePage(y.currentPage+1)),disabled:y.currentPage===D.totalPages,class:"arrow-button"},">",8,C)])])])}var D=o(6652),E=o(6278),H=o(7682),x=o(3959),I={name:"GroupManagement",data(){return{selectedDate:new Date((new Date).setDate((new Date).getDate()-1)),groupList:[],currentPage:1,itemsPerPage:15,showHelpPopover:!1,groupWeight:[]}},components:{Datepicker:D.A},methods:{formatDate(e){const t=e.getFullYear(),o=String(e.getMonth()+1).padStart(2,"0"),a=String(e.getDate()).padStart(2,"0");return`${t}-${o}-${a}`},async fetchData(){try{const e=await H.A.get("/group/getUsersRank",{params:{date:this.formatDate(this.selectedDate),group_no:this.getLoginInfo.group_no}});console.log(e.data,"그룹데이터"),this.groupList=e.data}catch(e){console.error("데이터 불러오기 실패:",e)}},changePage(e){e>=1&&e<=this.totalPages&&(this.currentPage=e)},downloadExcel(){const e=this.groupList.map((e=>({"마일리지 순위":e.user_rank,"직원번호":e.user_no,"직원명":e.user_name,"마일리지 합계":e.total_sum,HotTip:e.HotTip,"BEST Branch":e["BEST Branch"],"BEST PG":e["BEST PG"],"Monthly Base":e["Monthly Base"],"Monthly Best":e["Monthly Best"],"리그 테이블":e["리그 테이블"],HRD:e.HRD,"소비자 지원":e["소비자 지원"]}))),t=x.Wp.json_to_sheet(e),o=x.Wp.book_new();x.Wp.book_append_sheet(o,t,"그룹 마일리지 현황"),x._h(o,`${this.getLoginInfo.group_name}_마일리지_현황_${this.formatDate(this.selectedDate)}.xlsx`)},toggleHelpPopover(e){e.stopPropagation(),console.log("toggleHelpPopover 클릭"),this.showHelpPopover=!this.showHelpPopover,console.log("showHelpPopover:",this.showHelpPopover),this.showHelpPopover?document.addEventListener("click",this.handleClickOutside):document.removeEventListener("click",this.handleClickOutside)},handleClickOutside(e){console.log("handleClickOutside 실행"),!this.$refs.helpPopover||this.$refs.helpPopover.contains(e.target)||this.$refs.helpIcon.contains(e.target)||(console.log("팝오버 닫기"),this.showHelpPopover=!1,document.removeEventListener("click",this.handleClickOutside))},async getWeight(){try{const e=await H.A.get("/group/getWeight",{params:{group_no:this.getLoginInfo.group_no}});this.groupWeight=e.data}catch(e){console.error("데이터 불러오기 실패:",e)}}},computed:{...(0,E.L8)("login",["getLoginInfo"]),loginInfo(){return this.getLoginInfo},paginatedGroupList(){const e=(this.currentPage-1)*this.itemsPerPage,t=e+this.itemsPerPage;return this.groupList.slice(e,t)},totalPages(){return Math.ceil(this.groupList.length/this.itemsPerPage)},displayedPages(){const e=2;let t=Math.max(1,this.currentPage-e),o=Math.min(this.totalPages,this.currentPage+e);return o-t+1<2*e+1&&(1===t?o=Math.min(t+2*e,this.totalPages):t=Math.max(o-2*e,1)),Array.from({length:o-t+1},((e,o)=>t+o))}},watch:{selectedDate:{handler(){this.fetchData()},immediate:!0}},mounted(){this.fetchData(),this.getWeight()}},W=o(6262);const B=(0,W.A)(I,[["render",y],["__scopeId","data-v-5bf04205"]]);var M=B}}]);
//# sourceMappingURL=8392.6cfb32ec.js.map